(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{1234:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";var t=i(8);e.exports=t.extend({defaults:{domains:[],countries:[]}})})?s.apply(t,n):s)||(e.exports=r)},1235:function(e,t,i){(function(e){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[i(154)],s=function(t){"use strict";function s(e,t,i,s,n,r,o){try{var a=e[r](o),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(s,n)}function n(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var o=e.apply(t,i);function a(e){s(o,n,r,a,l,"next",e)}function l(e){s(o,n,r,a,l,"throw",e)}a(void 0)}))}}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}t=function(e){return e&&e.__esModule?e:{default:e}}(t);var o=i(27).$,a=i(536).to,l=i(155),c=l.audioMusicPatch,u=l.audioSoundEffectPatch,d=i(20),h=i(13).stringToKebabCase,f=(0,i(12).getLogger)(e),p=function(e){return new Promise((function(t,i){return o.getJSON(e).done(t).fail(i)}))},g="json",v=["mp3",g],m=function(e){var t=void 0===e?{}:e,i=t.fileId,s=t.filename,n=t.sellerId,r=t.thumbSource,o=t.ext,a=t.protocol,l=t.query;if(!i)return"";var c=v.includes(o)?o:"mp3";return d.urlFormat({protocol:a,host:r,pathname:n+"/a/depositphotos_"+i+"-"+s+"."+c,query:l})};e.exports=function(e){var i=e.getThumbSource,s=e.getSellerId,o=e.getFilename;return{defaults:{audioType:"",filesize:null,genre:null},initialize:function(){this.peaks=[]},parseSize:function(){return 1},makeUrl:function(){var e=o(this);return this.app.makeUrl({route:"AudioView",audioId:this.get("id"),audioType:this.get("audioType"),audioName:h(e).split("-").slice(0,5).join("-")},{absolute:!0})},makePreviewThumb:function(){return m({fileId:this.get("id"),filename:o(this),sellerId:s(this),thumbSource:i(this),protocol:this.app.parsedUrl.protocol})},makeThumbDownloadUrl:function(){return m({fileId:this.get("id"),filename:o(this),sellerId:s(this),thumbSource:i(this),protocol:this.app.parsedUrl.protocol,query:{download:!0}})},makePortfolioUrl:function(){return this.isMusicAudioType()?this.app.makeUrl(r({route:"Search",seller:s(this)},c)):this.app.makeUrl(r({route:"Search",seller:s(this)},u))},fetchPeaks:function(){var e=this;return n(t.default.mark((function n(){var r,o,l,c,u,h,v;return t.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.peaks.length>0)){t.next=2;break}return t.abrupt("return");case 2:return r=i(e),o=s(e),l=e.get("id"),c=d.urlFormat({protocol:e.app.parsedUrl.protocol,host:r,pathname:"/thumbs/"+o+"/"+l+"/awf."+g}),t.next=8,a(p(c));case 8:if(u=t.sent,h=u[0],v=u[1],!h&&v&&Array.isArray(v.data)){t.next=14;break}return f.error("Can not get peaks for audio id: "+l),t.abrupt("return");case 14:e.peaks=[].concat(v.data);case 15:case"end":return t.stop()}}),n)})))()},isMusicAudioType:function(){return"music"===this.get("audioType")}}}},void 0===(r="function"==typeof s?s.apply(t,n):s)||(e.exports=r)}).call(this,i(9)(e))},1236:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(723),s=i(836).prepareThumbFilename,n=["jpg","mp4","webm"];e.exports=function(){return{initialize:function(){this.videoThumbs={}},getVideoThumbs:function(e){var i=this;return void 0===e&&(e="wide"),this.videoThumbs&&this.videoThumbs[e]||(this.videoThumbs[e]={},n.forEach((function(n){i.videoThumbs[e][n]=t.getThumbUrl({ext:n,size:e,file:i.attributes,protocol:i.app.parsedUrl.protocol,genFilename:s.bind(i,i.app)})}))),this.videoThumbs[e]}}}},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1239:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var s=i(8),n=i(835);e.exports=s.extend(t({},n,{defaults:{id:null,imageUrl:"",width:null,height:null,type:"",alt:""},parse:function(e){return void 0===e&&(e={}),this.pickDefaultsFrom(e)}}))},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1246:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(0),s=i(1354),n=i(1426),r=s.Model.extend({constructor:function(e,t){void 0===t&&(t={}),this.app=t.app||t.collection&&t.collection.app,this.on({request:this.onRequest,sync:this.onSync,error:this.onError}),s.Model.call(this,e,t)},getQueryParams:function(){return t.clone(this.attributes)},exportSettings:function(e){return e?t.pick(this.attributes,e):t.clone(this.attributes)},importSettings:function(){},isBulkAllowed:function(){return!0},clone:function(e){return new this.constructor(this.attributes,e)},onRequest:function(){this.pending=!0},onSync:function(e,t,i){this.pending=!1,t.errors&&this.trigger("error",e,t,i)},onError:function(){this.pending=!1},secureSet:function(e,i,s){if(null===e)return!1;var n,r=s;"object"==typeof e?(n=e,r=i):(n={})[e]=i;var o=t.pick(n,t.intersection(t.keys(n),t.keys(this.attributes)));return!t.isEmpty(o)&&this.set(o,Object.assign(r||{},{validate:!0}))},secureSetParsed:function(e){return this.secureSet(this.parse(e))},resetToDefaults:function(e,i){var s=e?t.pick(this.defaults,e):this.defaults;return this.set(s,i)},getNonDefaults:function(e){var i=this,s=e?t.pick(this.attributes,e):this.attributes,n={};return t.each(s,(function(e,s){t.isEqual(i.defaults[s],e)||(n[s]=e)})),n},hasChangedExcept:function(e){var i=t.isArray(e)?e:[e];return t.size(t.omit(this.hasChanged(),i))>0},serialize:function(){return t.clone(this.attributes)},toAPI:function(){return{}}});Object.assign(r.prototype,n.mixin),e.exports=r},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1354:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";var t=i(27);t.oldSync=t.oldSync||t.sync,t.sync=function(e,i,s){if(!i.getQueryParams&&!s.getQueryParams||i.oldSync)return t.oldSync.call(this,e,i,s);if(!i.app){if("undefined"==typeof window||!window.app)throw new Error('Model\'s "app" object is not defined');i.app=window.app}return i.app.fetcher.request(e,i,s)},e.exports=t})?s.apply(t,n):s)||(e.exports=r)},1373:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(0),s=i(1246),n=[28,42,56,70];e.exports=s.extend({defaults:{route:"",offset:0,limit:n[0],page:1,totalItems:0,totalPages:0,pagerLimit:1,schema:{}},validation:{offset:{required:!0,pattern:/^[0-9]\d*$/,min:0,fn:function(e){if(e<0||this.get("totalItems")&&e>this.get("totalItems"))return"Invalid value for offset, given: "+e}},page:{required:!0,pattern:/^[1-9]\d*$/,min:1,fn:function(e){if(this.get("totalPages")&&e>this.get("totalPages"))return"Invalid value for page, given: "+e}}},getLimits:function(){return n},getQueryParams:function(){return this.pick(["limit","offset"])},initialize:function(e){var t=e.page,i=e.offset;t?this.mutateOffsetByPage(t):i&&this.mutatePageByOffset(i),this.on("change",this.calculate)},parse:function(e){return t.pick(e,t.keys(this.defaults))},calculate:function(e){t.has(e.changed,"page")&&this.mutateOffsetByPage(e.changed.page),(t.has(e.changed,"offset")||t.has(e.changed,"limit"))&&this.mutatePageByOffset(e.changed.offset),this.attributes.totalPages=Math.ceil(parseFloat(this.get("totalItems")/this.get("limit")))},mutateOffsetByPage:function(e){void 0===e&&(e=this.get("page")),this.attributes.offset=Math.max(parseInt(e,10)-1,0)*this.get("limit")},mutatePageByOffset:function(e){void 0===e&&(e=this.get("offset")),this.attributes.page=Math.floor(parseInt(e/this.get("limit"),10))+1},getSchema:function(){var e=this;if(!t.isEmpty(this.get("schema")))return this.get("schema");var i=function(t){return t<=0||t>e.get("totalPages")?null:e.getUrl({page:t})};return{current:this.getUrl(),buttons:{first:{href:i(this.validation.page.min),page:this.validation.page.min,active:this.get("page")!==this.validation.page.min},last:{href:i(this.get("totalPages")),page:this.get("totalPages"),active:this.get("page")!==this.get("totalPages")},prev:{href:i(this.getPrevPage()),page:this.getPrevPage(),active:this.hasPrevPage()},next:{href:i(this.getNextPage()),page:this.getNextPage(),active:this.hasNextPage()}}}},getUrl:function(e){void 0===e&&(e={});var t=Object.assign(this.getUrlParams(),this.serialize(),e);return this.app.makeUrl(t,this.getUrlQueryParams())},getUrlParams:function(){},getUrlQueryParams:function(){},hasNextPage:function(e){return void 0===e&&(e=this.get("page")),e<this.get("totalPages")},hasPrevPage:function(e){return void 0===e&&(e=this.get("page")),e>this.validation.page.min},getPrevPage:function(){return Math.max(parseInt(this.get("page"),10)-1,1)},getNextPage:function(){return Math.min(parseInt(this.get("page"),10)+1,this.get("totalPages"))},getNextOffset:function(){var e=parseInt(this.get("offset"),10),t=parseInt(this.get("limit"),10);return Math.min(e+t,this.get("totalItems"))}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1407:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(5).languages.accepts;e.exports={OurApps:function(e){return{isEnabled:e.lang!==t.zh}},About:function(e){return{socialLinksEnabled:e.lang!==t.zh}},FileViewThumb:function(e){return{isSharingEnabled:e.lang!==t.zh}},Share:function(e){return{socialTabEnabled:e.lang!==t.zh}},SearchHeaderFolder:function(e){return{isSharingEnabled:e.user.isLoggedIn()||e.lang!==t.zh}},FileViewModals:function(e){return{shouldHideTitle:e.features.isFeatureOnValue("NoTitleModal")}}}},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1422:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";var t=i(0),s=i(1246),n=i(1427),r=s.extend({defaults:{limit:60,offset:0}}),o=i(1373),a=s.extend({});e.exports=n.extend({storageKey:"pageable",endless:!1,pending:!1,byPageCache:{},modeIdToPageLinks:{},lastSyncOptions:{},getQueryParams:function(){var e=t.result(this.filters,"getQueryParams"),i=t.result(this.pager,"getQueryParams"),s=t.result(this.sorting,"getQueryParams");return Object.assign(e,i,s)},initialize:function(e,i){void 0===i&&(i={}),Object.assign(this,t.pick(i,["url","route","endless"])),this.initFilters(i.filters),this.initPager(i.pager),this.initSorting(i.sorting),this.listenTo(this.filters,"change",this.handleFiltersChange),this.listenTo(this.pager,"change",this.handlePagerChange),this.listenTo(this.sorting,"change",this.handleSortingChange),this.on({request:this.onCollectionRequest,sync:this.onCollectionSync,update:this.onCollectionUpdate,reset:this.onCollectionUpdate,sort:this.invalidateCaches})},initFilters:function(e){void 0===e&&(e={}),e.cid?this.filters=e:this.filters=new r(e,{app:this.app})},initPager:function(e){var i=this;void 0===e&&(e={}),e.cid?this.pager=e:(this.endless||t.defaults(e,{limit:t.result(this.app.settings.get(this.storageKey),"limit")}),this.pager=new o(e,{app:this.app}),e&&e.getUrlQueryParams&&(this.pager.getUrlQueryParams=function(){return e.getUrlQueryParams()})),this.pager.getUrlParams=function(){return i.getQueryParams()}},initSorting:function(e){void 0===e&&(e={}),e.cid?this.sorting=e:this.sorting=new a(e,{app:this.app})},fetch:function(e){if(this.pending)return!1;var i=Object.assign({remove:!this.endless,reset:t.result(e,"reset",this.isEmpty()),page:this.pager.get("page")},e);return this.endless&&(i.add=!0),this.endless&&this.pager.get("page")<this.pager.previous("page")&&(i.at=0),n.prototype.fetch.call(this,i)},serializePartial:function(){var e=this;return this.endless&&!t.result(this.lastSyncOptions,"reset")?t.map(this.getCachedPageIds(this.lastSyncOptions.page),(function(t){return e.get(t).serialize()})):n.prototype.serialize.call(this)},handleFiltersChange:function(e,i){var s=t.pick(e.changed,["limit","offset"]);t.isEmpty(s)||this.setPager(s,Object.assign({pageAbleInnerSync:!0},i)),i.pageAbleInnerSync||(this.resetCaches(),this.onFiltersChange(e,i))},handlePagerChange:function(e,t){t.pageAbleInnerSync||!(e.changed.page||e.changed.limit||e.changed.offset)||this.hasCachedPage(e.changed.page)||this.onPagerChange(e,t)},onFiltersChange:function(){},onPagerChange:function(){},handleSortingChange:function(){},onCollectionRequest:function(){this.pending=!0,this.lastSyncOptions={}},onCollectionSync:function(e,t,i){this.pending=!1,this.lastSyncOptions=i},onCollectionUpdate:function(){this.setPager({totalItems:this.totalItems}),this.invalidateCaches()},resetCaches:function(){this.modeIdToPageLinks={},this.byPageCache={}},invalidateCaches:function(){if(this.resetCaches(),this.endless)for(var e=Math.max(this.pager.get("limit"),1),t=0;t<this.models.length;t+=1){var i=Math.ceil((t+1)/e),s=this.models[t];this.modeIdToPageLinks[s.id]=i,this.byPageCache[i]?this.byPageCache[i].push(s.id):this.byPageCache[i]=[s.id]}},hasCachedPage:function(e){var t=this.byPageCache[+e];return t&&t.length===this.pager.get("limit")},getCachedPageIds:function(e){return this.byPageCache[parseInt(e,10)]},getPageByItemId:function(e){return this.modeIdToPageLinks[parseInt(e,10)]},getFilters:function(e){return t.isArray(e)?this.filters.pick(e):this.filters.get(e)},setFilters:function(){var e;return(e=this.filters).secureSet.apply(e,arguments)},getPager:function(e){return t.isArray(e)?this.pager.pick(e):this.pager.get(e)},setPager:function(){var e;return(e=this.pager).secureSet.apply(e,arguments)},getSorting:function(e){return t.isArray(e)?this.sorting.pick(e):this.sorting.get(e)},setSorting:function(){var e;return(e=this.sorting).secureSet.apply(e,arguments)},fetchPage:function(e,t){this.setPager({page:e?parseInt(e,10):this.getPager("page")},t),this.pager.hasChanged()||this.fetch(t)},fetchPrevPage:function(){!this.pending&&this.pager.hasPrevPage()&&this.setPager({page:this.pager.getPrevPage()})},fetchNextPage:function(e){void 0===e&&(e={}),!this.pending&&this.pager.hasNextPage()&&this.setPager({page:this.pager.getNextPage()},Object.assign({},e))}})}))},1424:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(531),s=i(529);e.exports=t.extend({name:"ActionTooltip",params:{type:"simple",rootClose:!0,hideOnScroll:!0,displayForce:!1,displayShowTimeout:0,displayHideTimeout:0,templatePosition:"bm",templatePriority:["bm","lm","auto"],templateOffset:{top:4,left:4},pointerShow:!0},classes:{tooltip_dark:!0},title:"",prepareContent:function(){var e=this;this.content=new s({el:!1,template:function(){return e.title}})},setTitle:function(e){void 0===e&&(e=""),this.title=e}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1426:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(164);Object.assign(t.validators,{boolean:function(e,t,i,s){if("boolean"!=typeof e)return this.format("{0} must be boolean",this.formatLabel(t,s))}}),Object.assign(t.patterns,{email:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),e.exports=t},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1427:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var s=i(1354),n=i(1246);e.exports=s.Collection.extend({model:n,constructor:function(e,t){var i=this;void 0===t&&(t={}),this.app=t.app,this.on("destroy",(function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return i.trigger.apply(i,["sync"].concat(t))})),s.Collection.call(this,e,t)},clone:function(e){return new this.constructor(this.models,{model:this.model,comparator:this.comparator},e)},getQueryParams:function(){return{}},_prepareModel:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=s.Collection.prototype._prepareModel.apply(this,t);return n.app=this.app,n},toPLAIN:function(e){return this.models.map((function(t){return t.get(e||t.idAttribute)}))},serialize:function(e){return void 0===e&&(e={}),this.models.map((function(t){return t.serialize(e)}))},toAPI:function(){return{}},isBulkAllowed:function(){return!0},sortByOrder:function(e,t){void 0===e&&(e=[]),void 0===t&&(t={}),this.models.sort((function(t,i){return e.includes(t.id)&&e.includes(i.id)?e.indexOf(t.id)-e.indexOf(i.id):0})),t.silent||this.trigger("sort",this,t)},promiseSync:function(e,i,s){var n=this;return void 0===s&&(s={}),new Promise((function(r,o){n.sync(e,i,t({},s,{success:function(e){return e.errors?o(e.errors):r(e)},error:function(e){o(e)}}))||o(new Error("There is no result returned"))}))}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1442:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";var t=i(1424),s="actionTooltip";e.exports={setActionTooltip:function(){this.setView(s,new t({app:this.app}))},showActionTooltip:function(e){var t=this.getView(s);t&&(t.setTitle(e.currentTarget.dataset.title),t.show(e))},hideActionTooltip:function(){var e=this.getView(s);e&&e.hide()}}})?s.apply(t,n):s)||(e.exports=r)},1445:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";e.exports.default={suppressScrollX:!0,wheelSpeed:.6,minScrollbarLength:30}})?s.apply(t,n):s)||(e.exports=r)},1502:function(e,t,i){},1538:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";e.exports={initSocialButtons:function(e){var t=this,i=this.app.user.isLoggedIn()?"-"+this.convertBaseNumber(this.app.user.get("id")):"";this.$("._share-button").each((function(s,n){var r=n.getAttribute("data-social"),o=e.shareData.title||n.getAttribute("data-title"),a=e.shareData.description||n.getAttribute("data-description"),l=t.getCustomSocialRedirectUrl({socialSuffix:e.socialNameMap[r],refId:i,element:n});switch(r){case"facebook":n.href=t.app.makeUrl("facebookSharer",{query:{u:l,title:o,description:a,caption:t.app.host,picture:e.shareData.image}});break;case"twitter":n.href=t.app.makeUrl("twitterSharer",{query:{url:l,via:"depositphotos",text:o+" #stock #photo"}});break;case"pinterest":n.href=t.app.makeUrl("pinterestSharer",{query:{url:l,media:e.shareData.image,description:o}});break;case"vk":n.href=t.app.makeUrl("vkSharer",{query:{url:l,title:o,description:a,image:e.shareData.image}});break;default:n.href=""}}))},convertBaseNumber:function(e){return parseInt(e,10).toString(36)},getCustomSocialRedirectUrl:function(e){return this.getSocialRedirectUrl?this.getSocialRedirectUrl(e):this.getDefaultSocialRedirectUrl(e)},getDefaultSocialRedirectUrl:function(e){var t=this.convertBaseNumber(""+e.socialSuffix+this.model.get("id"));return this.app.makeUrl("/v/"+t+e.refId,{absolute:!0})},handleShareButtonClick:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget,i=e.currentTarget.getAttribute("data-width"),s=e.currentTarget.getAttribute("data-height"),n="\n\t\t\ttop="+(screen.height/2-s/2).toFixed(0)+",left="+(screen.width/2-i/2).toFixed(0)+",width="+i+",height="+s+",resizable=yes,\n\t\t\tscrollbars=no,status=yes,location=no";window.open("about:blank",t.getAttribute("data-title"),n).location.href=t.href}}})?s.apply(t,n):s)||(e.exports=r)},1550:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";i(1833);var t=i(1834),s=i(529),n=i(537);e.exports=s.extend({name:"FolderPermissions",el:!1,template:t,disableRemove:!1,isMultipleSharing:!1,events:{"click ._access":"onAccessClick","click ._remove":"onRemoveClick"},initialize:function(){if(!this.model)throw new Error(this.name+" "+this.cid+": Permission model required!");if(!this.folder)throw new Error(this.name+" "+this.cid+": Folder model required!")},serialize:function(){return{permList:this.isMultipleSharing?this.getListForMultipleSharing():this.getList()}},getListForMultipleSharing:function(){return[{type:"access",name:"view",title:this.tr("Can View"),active:this.folder.hasAction("shareView")},{type:"access",name:"edit",title:this.tr("Can Edit"),active:this.folder.hasAction("shareEdit")}]},getList:function(){var e=this.model.get("type"),t=this.model.get("permission"),i=this.folder.get("permission"),s=this.app.user.get("id")===this.folder.get("userId"),n="user"===this.model.get("type")&&this.model.get("user").get("userId")===this.app.user.get("id"),r=!this.disableRemove&&"link"!==e&&(s||"edit"===i||n),o=[];return this.folder.hasAction("shareEdit")&&(o.push({type:"access",name:"view",title:this.tr("Can View"),active:"view"===t}),o.push({type:"access",name:"edit",title:this.tr("Can Edit"),active:"edit"===t})),r&&o.push({type:"remove",name:"remove",title:n?this.tr("Leave Collection"):this.tr("Remove")}),o},onAccessClick:function(e){e.stopPropagation();var t=e.currentTarget.dataset.name;this.isUserTryToDecreaseOwnAccess(t)?this.showConfirmationDialog(t):this.changeCallback(t)},onRemoveClick:function(e){e.stopPropagation(),this.removeCallback()},isUserTryToDecreaseOwnAccess:function(e){return!this.isMultipleSharing&&"user"===this.model.get("type")&&parseInt(this.model.get("user").get("userId"),10)===parseInt(this.app.user.get("id"),10)&&"edit"===this.model.get("permission")&&"view"===e},showConfirmationDialog:function(e){var t=this;new n({title:this.tr("Are you sure?"),message:this.tr("By changing sharing settings, you will no longer be able to edit this folder."),footer:[{label:this.tr("Yes"),hide:!0,color:"blue",defaultAction:!0,callback:function(){return t.changeCallback(e)}},{label:this.tr("No"),hide:!0}],destroyOnHide:!0,app:this.app}).show()},changeCallback:function(){},removeCallback:function(){}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1677:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(0),s=i(34),n=i(1818);e.exports=s.extend({url:"FolderPermissions",model:n,initialize:function(){var e=this;this.cid=t.uniqueId("col"),this.on("change",(function(t,i){void 0===i&&(i={}),i.observable&&e.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:e.cid,folderId:t.get("folderId")})})),this.on("update",(function(t,i){void 0===i&&(i={}),i.observable&&e.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:e.cid,folderId:t.length?t.first().get("folderId"):0})}))},parse:function(e){return e?e.result:[]},findPermissionByEmail:function(e){return this.find((function(t){return t.isMatchByEmail(e)}))}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1738:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}i(1825);var s=i(1826),n=i(529),r=i(1442);e.exports=n.extend(t({},r,{name:"FolderUsers",el:!1,template:s,maxAvatars:5,events:{"mouseenter ._avatar-box":"onAvatarBoxMouseEnter","mouseleave ._avatar-box":"onAvatarBoxMouseLeave"},initialize:function(){this.listenTo(this.collection,"change update reset",this.render)},prepareRender:function(){return this.users=this.collection.serialize().filter((function(e){return"link"!==e.type})).reverse(),!!this.users.length},serialize:function(){var e=this.users.slice(0,this.maxAvatars);return{users:this.prepareUsers(e),moreCount:this.users.length-e.length,ownerId:this.model.get("userId")}},clientAfterRender:function(){this.setActionTooltip()},prepareUsers:function(e){var t=this;return e.map((function(e){return t.model.get("userId")===e.userId?e.title=t.tr("%s is the owner",e.fullName):"edit"===e.permission?e.title=t.tr("%s can edit",e.fullName):e.title=t.tr("%s can view",e.fullName),e}))},onAvatarBoxMouseEnter:function(e){e.preventDefault(),this.showActionTooltip(e)},onAvatarBoxMouseLeave:function(e){e.preventDefault(),this.hideActionTooltip()}}))},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1749:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";var t=i(1261);e.exports=t.extend({name:"ShareModal",noBorder:!0,showTitle:!1,destroyOnHide:!0,options:{},modalClasses:"modal_share modal_with-poster",bodyClasses:"modal__body_share",footer:[],initialize:function(){this.options.callback&&(this.onAfterHideCallback=this.options.callback)},hideCallback:function(){this.hide()},shareCallback:function(){this.hide(),this.app.observer.fire("Notification",{type:"success"})}})})?s.apply(t,n):s)||(e.exports=r)},1750:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";i(1751);var t=i(1407),s=i(1752),n=i(1753),r=i(529),o=i(826),a=i(1538),l=r.extend({name:"Share",el:!1,template:s,props:{},activeTab:"email",events:{"click ._share-button":"handleShareButtonClick"},initialize:function(){if(this.props=t.Share(this.app),!this.model)throw new Error(this.name+" "+this.cid+": Model required!")},prepareRender:function(){var e=this,t=this.getSchema();t.length>1&&this.setViews({"._tabs":new o({schema:t,name:"ShareTabs",template:n,app:this.app,preventDefaultAction:!0,menuUnderline:!0,changeTabCallback:function(){return e.changeTabCallback()}})})},serialize:function(){var e=this.isCompact();return{isCompact:e,title:this.getTitle(),info:e?{}:this.model.serialize(),posterMap:this.getPosterMap(),emailSharingAllowed:this.emailSharingAllowed(),activeTab:this.activeTab}},clientAfterRender:function(){this.isCompact()||this.initSocialButtons({socialNameMap:{facebook:!0,twitter:!0,google:!1},shareData:this.getSocialShareData()})},isCompact:function(){return void 0===this.collection},emailSharingAllowed:function(){return this.app.user.isLoggedIn()},getSchema:function(){var e=[],t=!1;return this.emailSharingAllowed()&&(t=!0,e.push({key:"email",label:this.tr("Email"),active:"email"===this.activeTab})),this.isCompact()||(t=!0,e.push({key:"social",label:this.tr("Social"),active:!t||"social"===this.activeTab,enabled:this.props.socialTabEnabled})),e},getPosterMap:function(){var e=41,t=[],i=[],s=[];if(!this.isCompact()){this.collection.first(6).forEach((function(e){i.push(e.makeThumb("bigWide")),s.push(2*e.get("id").toString().substr(-1))}));for(var n=0;n<Math.max(Math.floor(i.length/2),1);n+=1){var r=e+s[n],o=[{url:i[2*n],width:r}],a=2*n+1;i[a]&&o.push({url:i[a],width:100-r}),t.push({images:o})}}return t},changeTabCallback:function(){this.app.observer.fire("Tooltip:GlobalHide",{cid:"all"});var e=this.findView("ShareTabs").getActiveTab();this.$("._wrap").removeClass("active").filter("[data-tab="+e.get("key")+"]").addClass("active"),this.activeTab=e.get("key")},getSocialRedirectUrl:function(e){return this.app.makeUrl("/f/"+this.model.get("id")+e.refId,{absolute:!0})},shareCallback:function(){}});Object.assign(l.prototype,a),e.exports=l}))},1751:function(e,t,i){},1752:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<div class="share-modal';if(e.onlyEmailSharing&&(i+=" share-modal_by-email"),i+='">',!e.isCompact){i+='<div class="share-modal__left"><div class="share-modal__info-box"><span class="share-modal__info-text share-modal__info-text_title">'+t(e.info.title)+'</span><span class="share-modal__info-text share-modal__info-text_count">'+this.tr("%s Files",[e.info.count])+'</span></div><div class="share-modal__poster-wrap share-modal__poster-wrap_rows'+t(e.posterMap.length)+' _poster">';var s=e.posterMap;if(s)for(var n,r=-1,o=s.length-1;r<o;){i+='<div class="share-modal__poster-row share-modal__poster-row_count'+t((n=s[r+=1]).images.length)+'">';var a=n.images;if(a)for(var l,c=-1,u=a.length-1;c<u;)i+='<div class="share-modal__poster-cell"style="width: '+t((l=a[c+=1]).width)+"%;",l.url&&(i+=" background-image: url("+t(l.url)+");"),i+='"></div>';i+="</div>"}i+="</div></div>"}return i+='<div class="share-modal__right"><h2 class="share-modal__title">'+e.title+'</h2><div class="share-modal__tabs _tabs"></div><div class="share-modal__wrap">',e.emailSharingAllowed&&(i+='<div class="share-modal__form',"email"===e.activeTab&&(i+=" active"),i+=' _form _wrap" data-tab="email"></div>'),e.isLinkSharingAllowed&&(i+='<div class="share-modal__link',e.emailSharingAllowed&&"link"!==e.activeTab||(i+=" active"),i+=' _link _wrap" data-tab="link"></div>'),e.isCompact||(i+='<div class="share-modal__social',e.emailSharingAllowed&&"social"!==e.activeTab||(i+=" active"),i+=' _wrap" data-tab="social"><a class="share-modal__social-btn button-share-circle button-share-facebook _share-button"rel="nofollow" data-width="650" data-height="370" data-title="Facebook" data-social="facebook"><span class="button-share-circle-text">Facebook</span></a><a class="share-modal__social-btn button-share-circle button-share-twitter _share-button" rel="nofollow" data-width="730" data-height="420" data-title="Tweet" data-social="twitter"><span class="button-share-circle-text">Twitter</span></a></div>'),i+="</div></div></div>"}},void 0===(r="function"==typeof s?s.apply(t,n):s)||(e.exports=r)},1753:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<ul class="share-tabs share-tabs_count-'+t(e.scheme.length)+'">',s=e.scheme;if(s)for(var n,r=-1,o=s.length-1;r<o;)(n=s[r+=1]).disabled||(i+='<li class="share-tabs__item',(n.active||n.pseudoActive)&&(i+=" share-tabs__item_active _tab-active"),i+=' _tab" data-key="'+t(n.key)+'"><span class="share-tabs__link">'+t(n.label)+"</span></li>");return i+='<li class="share-tabs__menu-underline hidden _menu-underline"></li></ul>'}},void 0===(r="function"==typeof s?s.apply(t,n):s)||(e.exports=r)},1762:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";var t=i(0),s=i(33).defaultFolders,n=i(51),r=i(1819),o=i(1763),a=i(13).stringToKebabCase;e.exports=n.extend({defaults:{id:null,title:"",description:"",count:0,isPublic:!0,isShared:!1,permission:"view",userId:null,userName:"",ownerAvatar:"",ownerApprovedFilesCount:0,coverCropData:{},preferences:[],allowedActions:[],thumbs:[]},relations:{preferences:r,thumbs:o},validation:{count:{pattern:"digits"},isPublic:{boolean:!0}},url:"Folder",lastSyncedAttrs:{},initialize:function(){var e=this;this.on("sync",this.makeKostylCleanUpCoverCropData),this.on("change",(function(t,i){void 0===i&&(i={}),i.observable&&e.app.observer.fire("Favorites:FolderChanged",{id:t.get("id"),cid:t.cid,changed:t.changed,options:i})}))},makeKostylCleanUpCoverCropData:function(e){e.get("preferences").get("coverItemId")&&(e.attributes.coverCropData={})},parse:function(e,i){if(void 0===e&&(e={}),e.errors)return{};i.parser=null;var s=e.lightbox?e.lightbox:e,n=t.pick(s,Object.keys(this.defaults));n.id=parseInt(s.lightboxId,10),n.userId=parseInt(s.userId,10),n.count=parseInt(s.count,10),n.isPublic=s.public,n.thumbs=s.items.filter((function(e){return!t.isEmpty(e)}));var r=this.experimentalTrueParseRelations(n,i);return Object.assign({},n,r)},serialize:function(){var e=this.getFolderTitle(this.attributes.title),t=this.generateLink(),i=this.get("userId")===this.app.user.get("id"),s=n.prototype.serialize.call(this);return Object.assign({},s,{title:e,link:t,isOwn:i})},toJSON:function(){return this.serialize()},generateLink:function(e){var t=this.get("title");return t?(t=a(t),this.app.makeUrl({route:"Folder",folderId:this.get("id"),folderName:t||"folder"},e)):""},getFolderTitle:function(e){return s.some((function(t){return t.label===e}))?this.app.tr(e):e},getQueryParams:function(){return Object.assign({},this.attributes)},savePreference:function(e,t){return this.get("preferences").get(e).set({value:t}),this.save({},{wait:!0})},hasAction:function(e){return this.get("allowedActions").includes(e)}})}))},1763:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(833),s=i(34);e.exports=s.extend({url:"Files",model:t,getQueryParams:function(){return{ids:this.pluck("id")}},parse:function(e,i){void 0===i&&(i={}),i.parser=i.parser||"parseFromSearch";var n=e.result||e;return i.trueparse?n.map((function(e){return t.prototype.parse(e,i)})):s.prototype.parse.call(this,n,i)}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1764:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";var t=i(864),s=i(1445).default,n=i(1832),r=i(534),o=i(529),a=i(1738),l=i(1550),c=i(531);e.exports=o.extend({name:"SharedUsers",el:!1,template:n,listOnly:!1,includeLink:!1,opened:!1,scrollPosition:0,events:{"click ._open-list":"onOpenListClick","click ._close-list":"onCloseListClick","click ._select-perm":"onSelectPermClick"},initialize:function(){if(!this.model)throw new Error(this.name+": Folder model required!");if(!this.collection)throw new Error(this.name+": FolderPermissions collection required!");this.listenTo(this.collection,"change update reset",this.render)},prepareRender:function(){this.setView("._users",new a({app:this.app,model:this.model,collection:this.collection}))},serialize:function(){return{opened:this.opened,listOnly:this.listOnly,includeLink:this.includeLink,linkPermission:this.getLinkPermission(),usersList:this.getUsersList(),ownerId:this.model.get("userId")}},clientAfterRender:function(){var e=this;this.opened&&setTimeout((function(){return e.initPerfectScrollbar()}),0)},initPerfectScrollbar:function(){var e=this.$("._scroll");t.initialize(e.get(0),s),e.scrollTop(this.scrollPosition)},getLinkPermission:function(){var e=this.collection.find((function(e){return"link"===e.get("type")}));return e?e.serialize():{}},getUsersList:function(){return this.opened?this.collection.serialize().filter((function(e){return"link"!==e.type})).reverse():[]},onOpenListClick:function(e){e.preventDefault(),this.opened=!0,this.render()},onCloseListClick:function(e){e.preventDefault(),this.opened=!1,this.render()},onSelectPermClick:function(e){e.stopPropagation();var t=e.currentTarget.dataset.email,i=this.collection.findPermissionByEmail(t),s=this.getView("FolderPermissions");if(this.selectedModel&&this.selectedModel.cid===i.cid)s&&s.toggle(e);else{var n=this.app.user.get("id")===this.model.get("userId"),o="user"===i.get("type")&&i.get("user").get("userId")===this.app.user.get("id");"view"!==this.model.get("permission")||n||o?(this.selectedModel=i,this.setView("FolderPermissions",new c({params:r.FolderPermissions,content:new l({app:this.app,model:i,folder:this.model,changeCallback:this.selectPermissionCallback.bind(this),removeCallback:this.removePermissionCallback.bind(this)})})),this.getView("FolderPermissions").show(e)):s&&s.isOpen()&&s.hide()}},saveScrollPosition:function(){this.scrollPosition=this.$("._scroll").scrollTop()},selectPermissionCallback:function(e){this.getView("FolderPermissions").hide(),this.saveScrollPosition(),this.selectedModel.updatePermission({permission:e})},removePermissionCallback:function(){this.getView("FolderPermissions").hide(),this.saveScrollPosition(),this.selectedModel.deletePermission()}})}))},1818:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(0),s=i(8),n=i(51);e.exports=n.extend({url:"FolderPermission",defaults:{type:"",permission:"",folderId:null,link:null,value:null,user:{}},relations:{user:s.extend({defaults:{userId:null,username:"",email:"",firstName:"",lastName:"",avatar:"/_img/avatar-border-default-30.png"},initialize:function(){var e=this;this.on("change:userId",(function(){e.attributes.userId=parseInt(e.attributes.userId,10)}))},parse:function(e){void 0===e&&(e={});var i=t.pick(e,Object.keys(this.defaults));return i.userId=parseInt(i.userId,10),i}})},parse:function(e){if(void 0===e&&(e={}),e.errors)return{};var i=t.pick(e,Object.keys(this.defaults));return i.folderId=parseInt(i.folderId,10)||this.defaults.folderId,i.link=e.link||null,"email"===i.type&&(i.user={email:e.value}),"user"===i.type&&(i.user=e.value),i},getQueryParams:function(){var e=Object.assign({emitter:this.app.uid},this.attributes,this.get("user").attributes);return"link"===this.get("type")&&(e.id=this.get("value")),"user"===this.get("type")&&(e.id=this.get("user").get("userId")),e.type="link"===e.type?e.type:"user",e},serialize:function(){return Object.assign(this.get("user").serialize(),{userId:parseInt(this.get("user").get("userId"),10),permission:this.get("permission"),type:this.get("type"),link:this.get("link"),fullName:this.getFullName()})},getFullName:function(){return this.get("user").get("firstName").length?(this.get("user").get("firstName")+" "+(this.get("user").get("lastName")||"")).trim():this.get("user").get("email")},isMatchByEmail:function(e){return"link"!==this.get("type")&&this.get("user").get("email")===e},updatePermission:function(e){return this.save(e,{wait:!0,observable:!0})},deletePermission:function(){var e=this;return this.sync("delete",this,{success:function(){return e.destroy({observable:!0})}})}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1819:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(0),s=i(8),n=i(34),r=s.extend({defaults:{name:"",label:"",value:null,editable:!0,selector:""},idAttribute:"name",lastSyncedAttrs:{},initialize:function(){var e=this;this.fakeNestedSaveLastSyncedAttrs(),this.on("change",(function(t,i){i.storeAsLastSynced&&e.fakeNestedSaveLastSyncedAttrs()}))},saveLastSyncedAttrs:function(e,t){t.errors||(this.lastSyncedAttrs=Object.assign({},this.lastSyncedAttrs,this.attributes))},resetToLastSynced:function(e,i){return this.set(e?t.pick(this.lastSyncedAttrs,e):this.attributes,i)},isChangedButNotSaved:function(e){return this.get(e)!==this.lastSyncedAttrs[e]},isChangedButNotSavedValue:function(){return this.isChangedButNotSaved("value")},resetToLastSyncedValue:function(){return this.resetToLastSynced("value")},fakeNestedSaveLastSyncedAttrs:function(){this.saveLastSyncedAttrs({},{})}});e.exports=n.extend({model:r,getPrefsAsHash:function(){var e=this.serialize(),t={};return e.forEach((function(e){t[e.name]=e.value})),t}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1825:function(e,t,i){},1826:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<div class="folder-users"><div class="folder-users__avatars">',s=e.users;if(s)for(var n,r=-1,o=s.length-1;r<o;)i+='<div class="folder-users__avatar _avatar-box" data-title="'+t((n=s[r+=1]).title)+'">',"email"===n.type?i+='<span class="shared-users__link-box"><i class="icon icon-sharing-email"></i></span>':i+='<span class="folder-users__avatar-box avatar-box avatar-box-m"><img class="folder-users__avatar-img avatar avatar-m" src="'+n.avatar+'" /></span>',n.userId===e.ownerId&&(i+='<i class="folder-users__star icon icon-star-owner"></i>'),i+="</div>";return i+="</div>",e.moreCount>0&&(i+='<div class="folder-users__more">+'+t(e.moreCount)+"</div>"),i+="</div>"}},void 0===(r="function"==typeof s?s.apply(t,n):s)||(e.exports=r)},1827:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(1749),s=i(1828);e.exports=t.extend({name:"ShareFolder",body:function(){return new s({app:this.app,model:this.model,collection:this.collection,permissions:this.permissions,asyncPermissionsLoad:this.asyncPermissionsLoad,shareCallback:this.shareCallback.bind(this),hideCallback:this.hideCallback.bind(this)})}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1828:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var s=i(1750),n=i(1677),r=i(1829),o=i(1842);e.exports=s.extend({name:"ShareFolder",asyncPermissionsLoad:!1,initialize:function(){if(s.prototype.initialize.call(this),!this.asyncPermissionsLoad&&!this.permissions)throw new Error(this.name+" "+this.cid+": FolderPermissions collection required!");!this.isMultipleSharing()&&this.asyncPermissionsLoad&&(this.permissions=new n([],{app:this.app}),this.permissions.getQueryParams={folderId:this.model.get("id")},this.permissions.fetch({reset:!0}))},prepareRender:function(){this.setTabActive(),s.prototype.prepareRender.call(this);var e=this.isCompact()&&!this.linkSharingAllowed(),t={"._form":new r({app:this.app,folder:this.model,permissions:this.permissions,isMultipleSharing:this.isMultipleSharing(),shouldShowTitle:!e,shareCallback:this.shareCallback.bind(this)})};!this.isMultipleSharing()&&this.emailSharingAllowed()&&(t["._link"]=new o({app:this.app,folder:this.model,permissions:this.permissions,hideCallback:this.hideCallback.bind(this)})),this.setViews(t)},serialize:function(){var e=this.linkSharingAllowed();return t({},s.prototype.serialize.call(this),{isLinkSharingAllowed:e,onlyEmailSharing:this.isCompact()&&!e})},getTitle:function(){return this.isMultipleSharing()?this.tr("Share Collections"):this.tr("Share Collection")},isMultipleSharing:function(){return this.model instanceof Array&&this.model.length>1},linkSharingAllowed:function(){return!this.isMultipleSharing()&&"edit"===this.model.get("permission")&&this.app.user.isLoggedIn()},getSocialShareData:function(){return{title:this.model.get("title"),description:this.model.get("description"),image:this.collection.length?this.collection.first().makeThumb("huge"):""}},setTabActive:function(){if(this.permissions){var e=this.permissions.findWhere({type:"link"});this.permissions.where({type:"user"}).length<=1&&e&&"edit"===e.get("permission")&&(this.activeTab="link")}},getSchema:function(){var e=[].concat(s.prototype.getSchema.call(this));return this.linkSharingAllowed()&&e.splice(1,0,{key:"link",label:this.tr("Link"),active:"link"===this.activeTab}),e}})}))},1829:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";i(1830);var t=i(0),s=i(534),n=i(1831),r=i(597),o=i(599),a=i(1764),l=i(1550),c=i(531),u=i(1835),d=i(1836),h=i(1841),f=[r.space,r.enter,r.semicolon,r.comma],p=[";"],g=[r.space,r.semicolon,r.comma];e.exports=o.extend({name:"ShareFolderForm",el:!1,template:n,isMultipleSharing:!1,shouldShowTitle:!0,events:Object.assign({},o.prototype.events,{"click ._add-perm":"onAddPermClick"}),initialize:function(){this.model=new u({foldersID:this.getSharingIds(),maxEmails:20},{app:this.app}),this.shareEmailsCollection=new h([],{app:this.app}),this.listenTo(this.model,{invalid:this.showErrors,sync:this.onSubmitForm,"change:permission":this.render})},prepareRender:function(){!this.isMultipleSharing&&this.canSetPermission()&&this.setView("._shared",new a({app:this.app,model:this.folder,collection:this.permissions})),this.setMultiInput()},setMultiInput:function(){var e=this,t=function(t){return e.fieldReset(e.$(t.currentTarget).closest("._errorHolder"))};this.setView("._share-multiple-emails",new d({app:this.app,collection:this.shareEmailsCollection,parseRecieverData:function(t){return e.parseEmails(t)},onItemDeleteCallback:t,onItemFocusCallback:t,onItemBlurCallback:t,onReceiverFocusCallback:t,onReceiverBlurCallback:t,receiverCreateKeyCodes:f,receiverCreateKeys:p,itemEditExcludedKeys:g}))},serialize:function(){return{formData:this.model.serialize(),canShareForEdit:this.canShareForEdit(),canSetPermission:this.canSetPermission(),permissionLabel:this.getPermissionLabel(),permissionType:this.model.get("permission"),shouldShowTitle:this.shouldShowTitle}},clientAfterRender:function(){this.canSetPermission()&&this.setView("AddFolderPermissions",new c({params:s.FolderPermissions,content:new l({app:this.app,model:this.model,folder:this.folder,disableRemove:!0,isMultipleSharing:this.isMultipleSharing,changeCallback:this.selectPermissionCallback.bind(this)})}))},getSharingIds:function(){return this.isMultipleSharing?this.folder.map((function(e){return e.get("id")})):this.folder.get("id")},canSetPermission:function(){return this.isMultipleSharing?this.folder.every((function(e){return"edit"===e.get("permission")})):"edit"===this.folder.get("permission")},canShareForEdit:function(){return this.isMultipleSharing?this.folder.every((function(e){return e.hasAction("shareEdit")})):this.folder.hasAction("shareEdit")},getPermissionLabel:function(){return"edit"===this.model.get("permission")?this.tr("Can Edit"):this.tr("Can View")},onFieldFocusOut:function(e){if(e.currentTarget.value.length){var t="email"===e.currentTarget.name?this.$(e.currentTarget).closest("._errorHolder"):this.$(e.currentTarget).parent();this.fieldCorrect(t)}},onSubmitForm:function(e,t){t&&t.errors instanceof Array&&this.showSubmitError(t.errors[0].error_message)},onAddPermClick:function(e){e.preventDefault(),this.getView("AddFolderPermissions").toggle(e)},showErrors:function(e,t){var i=this;void 0===t&&(t={}),this.$("label:not(.field-box_correct) input, label:not(.field-box_correct) textarea").each((function(e){return i.fieldReset(i.$(e).parent())})),Object.keys(t).forEach((function(e){var s=t[e]instanceof Array?t[e][0]:t[e],n="emails"===e?i.$("._errorHolder"):i.$("input[name="+e+"], textarea[name="+e+"]").parent();i.fieldIncorrect(n,{errorMessage:s.length?i.tr(s):s})}))},showSubmitError:function(e){if(e){var t=this.$("._submit-error");t.toggleClass("hidden",!1),t.text(e)}},serializeForm:function(){return{emails:this.getEmailsArray(),subject:this.$el.find("._share-subject").val()}},parseEmails:function(e){return t.uniq(t.compact(e.split(/[\s,;]+/))).map((function(e){return{value:e}}))},getEmailsArray:function(){return t.pluck(this.shareEmailsCollection.serialize(),"value")},prepareSubmit:function(){this.model.set({emails:this.getEmailsArray()})},submit:function(){var e=this;this.model.save(this.serializeForm(),{wait:!0,success:function(){e.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:"all",folderId:e.getSharingIds()}),e.shareCallback()}})},selectPermissionCallback:function(e){this.getView("AddFolderPermissions").hide(),this.model.set({permission:e})},shareCallback:function(){}})}))},1830:function(e,t,i){},1831:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";e.exports=function(e){var t='<form class="share-email">';return e.shouldShowTitle&&(t+='<span class="share-email__title">'+this.tr("Invite people to collaborate via Email")+":</span>"),t+='<div class="share-email__field field-box input-box input-box-xxxl input-box-params',e.canShareForEdit||(t+=" share-email__field_no-perms"),t+=' _errorHolder"><div class="input-params-wrap"><span class="input-params-title">'+this.tr("To:")+'</span><div class="_emails-counter share-modal__emails-counter-box"></div><div class="multi-input-box _share-multiple-emails"></div><div class="cmp-option-select input-params-select"><div class="cmp-option-select-wrap _add-perm">',"view"===e.permissionType&&(t+='<i class="icon-folder-action-view cmp-option-select-icon"></i>'),"edit"===e.permissionType&&(t+='<i class="icon-folder-action-edit cmp-option-select-icon"></i>'),t+='<i class="cmp-option-select-arrow arrow arrow-bottom arrow-block-1"></i></div></div></div></div><div class="share-email__shared _shared"></div><button class="share-email__submit button button-xxl button-watery button-blue _submit" type="submit">'+this.tr("Share")+"</button></form>"}})?s.apply(t,n):s)||(e.exports=r)},1832:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<div class="shared-users';if(e.opened&&(i+=" shared-users_opened"),e.listOnly&&(i+=" shared-users_list-only"),i+='">',e.listOnly||(i+='<span class="shared-users__title">'+this.tr("Shared with:")+"</span>"),e.opened){e.listOnly||(i+='<i class="shared-users__close arrow arrow-top arrow-block-1 _close-list"></i>'),i+='<div class="shared-users__list-box _scroll"><ul class="shared-users__list">',e.includeLink&&(i+='<li class="shared-users__list-row shared-users__list-row_type"><div class="shared-users__user"><div class="shared-users__avatar"><span class="shared-users__link-box"><i class="icon icon-sharing-link"></i></span></div><span class="shared-users__user-email">'+this.tr("Link Sharing")+'</span><span class="shared-users__user-name">',"edit"===e.linkPermission.permission?i+=""+this.tr("Anyone with the link can edit"):i+=""+this.tr("Anyone with the link can view"),i+='</span></div><div class="shared-users__perm">',"edit"===e.linkPermission.permission?i+='<i class="icon icon-folder-action-edit"></i>':i+='<i class="icon icon-folder-action-view"></i>',i+="</div></li>");var s=e.usersList;if(s)for(var n,r=-1,o=s.length-1;r<o;)(n=s[r+=1]).userId===e.ownerId?(i+='<li class="shared-users__list-row"><div class="shared-users__user"><div class="shared-users__avatar"><span class="shared-users__avatar-box avatar-box avatar-box-m"><img class="shared-users__avatar-img avatar avatar-m" src="'+n.avatar+'" /></span>',n.userId===e.ownerId&&(i+='<i class="shared-users__star icon icon-star-owner"></i>'),i+='</div><span class="shared-users__user-name">',n.firstName.length||n.lastName.length?i+=t(n.firstName)+" "+t(n.lastName):i+=""+t(n.username),i+='</span><span class="shared-users__user-email" title="'+t(n.email)+'">'+t(n.email)+'</span></div><div class="shared-users__perm"><span class="shared-users__creator">'+this.tr("Creator")+"</span></div></li>"):(i+='<li class="shared-users__list-row shared-users__list-row_hoverable _select-perm"data-id="'+t(n.email)+'"data-email="'+t(n.email)+'"><div class="shared-users__user">',"email"===n.type?i+='<div class="shared-users__avatar"><span class="shared-users__link-box"><i class="icon icon-sharing-email"></i></span></div>':(i+='<div class="shared-users__avatar"><span class="shared-users__avatar-box avatar-box avatar-box-m"><img class="shared-users__avatar-img avatar avatar-m" src="'+n.avatar+'" /></span>',n.userId===e.ownerId&&(i+='<i class="shared-users__star icon icon-star-owner"></i>'),i+="</div>"),i+='<span class="shared-users__user-name">',n.firstName.length||n.lastName.length?i+=t(n.firstName)+" "+t(n.lastName):i+=""+t(n.username),i+='</span><span class="shared-users__user-email" title="'+t(n.email)+'">'+t(n.email)+'</span></div><div class="shared-users__perm">',"edit"===n.permission?i+='<i class="icon icon-folder-action-edit"></i>':i+='<i class="icon icon-folder-action-view"></i>',i+="</div></li>");i+="</ul></div>"}else i+='<div class="shared-users__avatars _users _open-list"></div><i class="shared-users__icon arrow arrow-bottom arrow-block-1 _open-list"></i>';return i+="</div>"}},void 0===(r="function"==typeof s?s.apply(t,n):s)||(e.exports=r)},1833:function(e,t,i){},1834:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<ul class="folder-perm-tooltip">',s=e.permList;if(s)for(var n,r=-1,o=s.length-1;r<o;)i+='<li class="folder-perm-tooltip__item folder-perm-tooltip__item_'+t((n=s[r+=1]).type)+" _"+t(n.type)+'" data-name="'+t(n.name)+'">',n.active&&(i+='<i class="folder-perm-tooltip__icon icon icon-ok"></i>'),i+='<span class="folder-perm-tooltip__title">'+t(n.title)+"</span></li>";return i+="</ul>"}},void 0===(r="function"==typeof s?s.apply(t,n):s)||(e.exports=r)},1835:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(33).validationMessages,s=i(0),n=i(8);e.exports=n.extend({url:"ShareFolder",defaults:{folderID:null,rawEmails:"",emails:[],subject:"",type:"email",permission:"view",maxEmails:65535},validation:{emails:function(e){var t=this;if(!e.length)return!0;if(e.length>this.get("maxEmails"))return this.app.translator.tr(this.getValidationMessage("tooMuchEmails"),[this.get("maxEmails")]);var i=null;return e.find((function(e){return e.length<3?(i=t.getValidationMessage("emailMin"),!0):e.length>128?(i=t.getValidationMessage("emailMax"),!0):!t.isEmail(e)&&(i=t.getValidationMessage("multipleEmail"),!0)})),i},permission:{oneOf:["view","edit"]},type:{oneOf:["user","email"]}},isEmail:function(e){return/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i.test(e)},getValidationMessage:function(e){return t.find((function(t){return t.key===e})).label},parse:function(e){return s.pick(e,s.keys(this.defaults))},getQueryParams:function(){return Object.assign({},this.attributes,{type:"user"})}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1836:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";i(1837);var t=i(864),s=i(1445).default,n=i(1838),r=i(597),o=i(529),a=i(1839);e.exports=o.extend({name:"MultiInput",el:!1,template:n,isReceiverInFocus:!1,receiverCreateKeyCodes:[r.enter],receiverCreateKeys:[],itemEditExcludedKeys:[],events:{"focus ._multi-input-receiver":"onReceiverFocus","blur ._multi-input-receiver":"onReceiverBlur","keydown ._multi-input-receiver":"onReceiverKeyDown","input ._multi-input-receiver":"onReceiverInput","mousedown ._multi-input-content":"onMultiInputMousedown","click ._multi-input-content":"onMultiInputClick"},prepareRender:function(){this.setViews({"._items-list":new a({collection:this.collection,onItemChangeCallback:this.onItemChangeCallback.bind(this),onItemDeleteCallback:this.onItemDeleteCallback.bind(this),onItemFocusCallback:this.onItemFocusCallback.bind(this),onItemBlurCallback:this.onItemBlurCallback.bind(this),setReceiverFocus:this.setReceiverFocus.bind(this),addedAfterRender:this.itemsAfterAddCallback.bind(this),removedAfterRender:this.itemsAfterRemoveCallback.bind(this),excludedKeys:this.itemEditExcludedKeys})})},clientAfterRender:function(){this.perfectScrollbar=t,this.perfectScrollbar.initialize(this.$("._scroll").get(0),s)},onMultiInputMousedown:function(e){e.currentTarget===e.target&&(e.preventDefault(),e.stopPropagation())},onMultiInputClick:function(e){this.isReceiverInFocus||e.currentTarget===e.target&&this.setReceiverFocus()},onReceiverInput:function(e){var t=this.$("._multi-input-receiver-meter");t.text(e.currentTarget.value),t.outerWidth()>0?this.$(e.currentTarget).outerWidth(t.outerWidth()+3).outerHeight(t.outerHeight()):this.$(e.currentTarget).removeAttr("style"),this.updateScrollbar()},onReceiverKeyDown:function(e){this.createItemTriggered(e)&&this.createItems(e),e.keyCode===r.tab&&this.onReceiverTabPress(e)},createItemTriggered:function(e){return this.receiverCreateKeyCodes.some((function(t){return t===e.keyCode}))||this.receiverCreateKeys.some((function(t){return t===e.key}))},createItems:function(e){e.preventDefault(),this.saveReceiverData(e),this.resetReceiver()},onReceiverTabPress:function(e){this.getReceiverData()&&(e.preventDefault(),this.saveReceiverData(e),this.resetReceiver())},onReceiverFocus:function(e){this.isReceiverInFocus=!0,this.onReceiverFocusCallback(e)},onReceiverBlur:function(e){this.isReceiverInFocus=!1,this.saveReceiverData(e),this.resetReceiver(),this.onReceiverBlurCallback(e)},saveReceiverData:function(e){var t=this.getReceiverData();t&&this.addNewItemsToCollection(t)},resetReceiver:function(){var e=this.getReceiver();e.setAttribute("style",""),e.value="",this.$("._multi-input-receiver-meter").html("")},setReceiverFocus:function(){this.getReceiver().focus()},getReceiver:function(){return this.$("._multi-input-receiver")[0]},getReceiverData:function(){var e=this.getReceiver().value;return""!==e&&this.parseRecieverData(e)},parseRecieverData:function(e){return[{value:e}]},addNewItemsToCollection:function(e){void 0===e&&(e=[]);var t=this.prepareItems(e);t.length?this.collection.add(t):(this.resetReceiver(),this.scrollToReciever())},prepareItems:function(e){var t=this;return e.filter((function(e){return!t.collection.some((function(t){return t.get("value")===e.value}))}))},onItemDeleteCallback:function(){},onItemFocusCallback:function(){},onItemBlurCallback:function(){},onReceiverFocusCallback:function(){},onReceiverBlurCallback:function(){},itemsAfterAddCallback:function(){this.scrollToReciever()},itemsAfterRemoveCallback:function(){this.updateScrollbar()},onItemChangeCallback:function(){this.updateScrollbar()},scrollToReciever:function(){this.updateScrollbar(),this.$("._scroll").scrollTop(65535)},updateScrollbar:function(){t.update(this.$("._scroll").get(0))}})}))},1837:function(e,t,i){},1838:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";e.exports=function(e){return'<div class="multi-input"><div class="multi-input__content-wrapper _scroll"><div class="multi-input__content _multi-input-content"><span class="multi-input__receiver-meter _multi-input-receiver-meter"></span><div class="_items-list"></div><div class="_multi-input-receiver-box"><textarea class="multi-input__receiver _multi-input-receiver" type="text" autocomplete="off" placeholder="'+("undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}())(this.tr("Email"))+'"></textarea></div></div></div></div>'}})?s.apply(t,n):s)||(e.exports=r)},1839:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";var t=i(534),s=i(597),n=i(1840),r=i(529),o=i(531);e.exports=r.extend({name:"MultiInputItem",el:!1,template:n,excludedKeys:[],addedAfterRenderNeeded:!1,removedAfterRenderNeeded:!1,events:{"focus ._item-text":"onItemFocus","blur ._item-text":"onItemBlur","keydown ._item-text":"onItemtKeyDown","input ._item-text":"onItemtInput","mousedown ._item-delete":"onDeleteMouseDown","click ._item-delete":"onDeleteClick","mouseenter ._item-invalid":"showValidationTip","mouseleave ._item-invalid":"hideValidationTip"},initialize:function(){this.listenTo(this.collection,"update reset",(function(e,t){var i=t.changes,s=i.added,n=i.removed;this.addedAfterRenderNeeded=!!s.length,this.removedAfterRenderNeeded=!!n.length,this.render()})),this.listenTo(this.collection,"change",this.onItemChangeCallback)},serialize:function(){return{items:this.collection.serialize()}},clientAfterRender:function(){this.setValidationTip(),this.addedAfterRenderNeeded&&this.addedAfterRender(),this.removedAfterRenderNeeded&&this.removedAfterRender(),this.restoreFocus()},setValidationTip:function(){this.setNotExistView("validationTip",o,{params:t.multiInputValidationTip,content:new r({el:!1,template:function(){return""}})})},showValidationTip:function(e){var t=e.currentTarget.dataset.id,i=this.collection.get(t).validationMessage,s=void 0===i?"":i;this.getView("validationTip").content.template=function(){return s},this.getView("validationTip").show(e)},hideValidationTip:function(){this.getView("validationTip").hide()},onItemtKeyDown:function(e){e.keyCode===s.enter&&this.onItemEnterPress(e),this.excludedKeys.some((function(t){return t===e.keyCode}))&&e.preventDefault(),e.keyCode===s.tab&&this.onItemtTabPress(e)},onItemtInput:function(e){this.streamChangesToModel(e)},streamChangesToModel:function(e){var t=this.$(e.currentTarget).closest("._item"),i=t.attr("data-id"),s=this.collection.get(i),n=this.$(e.currentTarget).html();s.set({value:n}),s.validate(),s.isValid()&&this.getView("validationTip").hide(),t.toggleClass("_item-invalid multi-input-item_invalid",!s.isValid())},onItemEnterPress:function(e){e.preventDefault(),this.itemInputAction(e),this.setReceiverFocus()},onItemtTabPress:function(e){""===this.$(e.currentTarget).html()&&(this.focusStats={itemIndex:this.$(e.currentTarget).closest("._item").index(),cursorMoveDirection:e.shiftKey?"back":"forward"})},restoreFocus:function(){if(this.focusStats){var e=this.focusStats,t=e.itemIndex,i="forward"===e.cursorMoveDirection?t:t-1;this.$("._item").eq(i).find("._item-text").focus(),this.focusStats=null}},onItemFocus:function(e){this.onItemFocusCallback(e)},onItemBlur:function(e){this.itemInputAction(e),this.onItemBlurCallback(e)},itemInputAction:function(e){var t=this.$(e.currentTarget),i=t.html(),s=t.closest("._item").attr("data-id");""!==i?this.changeItemInCollection(s,{value:i}):this.removeItemInCollection(s)},onDeleteMouseDown:function(e){e.preventDefault()},onDeleteClick:function(e){e.preventDefault(),this.deleteItem(e)},deleteItem:function(e){var t=this.$(e.currentTarget).closest("._item").attr("data-id");this.removeItemInCollection(t),this.hideValidationTip(),this.onItemDeleteCallback(e)},changeItemInCollection:function(e,t){void 0===t&&(t={}),this.collection.get(e).set(t)},removeItemInCollection:function(e){this.collection.remove(e)},onItemDeleteCallback:function(){},onItemChangeCallback:function(){},onItemFocusCallback:function(){},onItemBlurCallback:function(){},addedAfterRender:function(){},removedAfterRender:function(){}})}))},1840:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i="<div>",s=e.items;if(s)for(var n,r=-1,o=s.length-1;r<o;)i+='<span class="multi-input-item _item',!1===(n=s[r+=1]).isValid&&(i+=" multi-input-item_invalid _item-invalid"),i+='" data-id="'+t(n.id)+'"><span class="multi-input-item__text _item-text" contenteditable="true">'+t(n.value)+'</span><i class="multi-input-item__delete _item-delete"></i></span>';return i+="</div>"}},void 0===(r="function"==typeof s?s.apply(t,n):s)||(e.exports=r)},1841:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(33).validationMessages,s=i(8),n=i(34);e.exports=n.extend({model:s.extend({defaults:{value:""},initialize:function(){var e=this;this.on("add",(function(t,i,s){var n=e.validate();n&&(t.validationMessage=e.getValidationMessage(n))}))},validation:{value:[{required:!0,msg:t.find((function(e){return"required"===e.key})).label},{minLength:3,msg:t.find((function(e){return"emailMin"===e.key})).label},{maxLength:128,msg:t.find((function(e){return"emailMax"===e.key})).label},{pattern:"email",msg:t.find((function(e){return"email"===e.key})).label}]},serialize:function(){return Object.assign({},this.attributes,{id:this.cid,isValid:this.isValid()})},getValidationMessage:function(e){return e&&e.value||null}})})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},1842:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";var t=i(534),s=i(1843),n=i(599),r=i(1550),o=i(531);e.exports=n.extend({name:"ShareLinkForm",el:!1,template:s,events:Object.assign({},n.prototype.events,{"click ._done":"onDoneClick","click ._add-perm":"onAddPermClick","click ._link-field":"onLinkFieldClick","click ._link-copy":"onLinkCopyClick"}),initialize:function(){var e=this;this.listenTo(this.permissions,{"change:permission":function(t){"link"===t.get("type")&&e.render()},update:this.render,reset:this.render})},prepareRender:function(){return this.model=this.permissions.findWhere({type:"link"}),void 0!==this.model},serialize:function(){return{canShareForEdit:this.canShareForEdit(),sharedLink:this.getSharedLink(),permissionLabel:this.getPermissionLabel()}},clientAfterRender:function(){this.model&&this.setView("AddFolderPermissions",new o({params:t.FolderPermissions,content:new r({app:this.app,model:this.model,folder:this.folder,changeCallback:this.selectPermissionCallback.bind(this)})}))},canShareForEdit:function(){return this.folder.hasAction("shareEdit")},getPermissionLabel:function(){return"edit"===this.model.get("permission")?this.tr("Can Edit"):this.tr("Can View")},onDoneClick:function(){this.hideCallback()},onAddPermClick:function(e){e.preventDefault(),this.getView("AddFolderPermissions").toggle(e)},onLinkFieldClick:function(e){e.currentTarget.select()},onLinkCopyClick:function(){var e=this.$("._link-field").get(0);e.select();try{document.execCommand("copy")&&this.app.observer.fire("Notification",{type:"success",description:this.tr("Link copied to the clipboard.")})}catch(e){}e.selectionStart=-1,e.selectionEnd=-1},getSharedLink:function(){return this.model.get("link")||this.app.makeUrl({route:"Folder",folderId:this.folder.get("id"),folderName:this.folder.get("title")},{absolute:!0})},selectPermissionCallback:function(e){this.model.updatePermission({permission:e}),this.getView("AddFolderPermissions").hide()},hideCallback:function(){}})}))},1843:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<form class="share-link';return e.canShareForEdit||(i+=" share-link__no-perms"),i+='"><form class="share-link"><span class="share-link__title">'+this.tr("Collaborate by sharing link")+':</span><div class="share-link__field field-box input-box input-box-xxxl input-box-params"><div class="input-params-wrap"><input class="input input-xxxl _link-field" type="text" name="link" value="'+t(e.sharedLink)+'" autocomplete="off" readonly /><div class="input-params-select"><span class="input-action-wrap _link-copy"><span class="input-action">'+this.tr("Copy link")+'</span></span></div></div></div><div class="share-link__perm"><div class="share-link__perm-title">'+this.tr("Users with the link")+':</div><div class="cmp-option-select share-link__perm-select"><div class="cmp-option-select-wrap _add-perm"><span class="cmp-option-select-value">'+t(e.permissionLabel)+'</span><i class="cmp-option-select-arrow arrow arrow-bottom arrow-block-1"></i></div></div></div><button class="share-link__done button button-xxl button-watery button-blue _done">'+this.tr("Done")+"</button></form>"}})?s.apply(t,n):s)||(e.exports=r)},2126:function(e,t,i){(function(e){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";i(2734);var t=i(534),s=i(830).spinner,n=i(2735),r=i(831),o=i(529),a=i(531),l=i(13).safeChain,c=i(2736),u=i(2300),d=(0,i(12).getLogger)(e);e.exports=o.extend({name:"FoldersSelect",el:!1,template:n,selectableGroup:!1,excludeActive:!1,onlyEditable:!1,containersOnly:!1,selected:null,events:{click:"onClick"},initialize:function(){this.listenTo(this.activeFolder,{destroy:this.handleFoldersRemove,sync:this.handleFoldersSync,"change:count":this.handleFoldersSync,"change:id":this.render}),this.listenTo(this.folders,{remove:this.handleFoldersRemove,sync:this.handleFoldersSync,add:this.handleFoldersAdd}),this.listenTo(this.app.observer,{"Favorites:RemoteFolderChanged":this.handleRemoteFolderChanged});var e={page:1,limit:100};this.ownFolders=new u([],{app:this.app,endless:!0,filters:{permission:["owner"]},pager:e}),this.sharedFolders=new u([],{app:this.app,endless:!0,filters:{permission:this.onlyEditable?["edit"]:["edit","view"]},pager:e}),this.fetchFolders(!0)},serialize:function(){var e=this.getSelectedFolder(),t={title:this.tr(this.app.user.isLoggedIn()?"My Folders":"My Photos"),isShownCounter:this.app.user.isLoggedIn()};if(this.state&&this.state.isEmptyFoldersMode()||!this.app.user.isLoggedIn())return{emptyFolder:t,className:this.className,containersOnly:this.containersOnly};if(this.state&&!this.state.isFilesMode()){var i="owner"===this.state.get("folderID"),s=i?this.ownFolders.getPager("totalItems"):this.sharedFolders.getPager("totalItems");return{emptyFolder:t,className:this.className,folder:{isOwn:i,count:s,title:this.state.getFoldersGroupTitle()},containersOnly:this.containersOnly}}var n=e&&e.get("id")?Object.assign(e.serialize(),{isOwn:e.get("userId")===parseInt(this.app.user.get("id"),10),color:this.getFolderColor()}):null;return{emptyFolder:t,className:this.className,folder:n,containersOnly:this.containersOnly}},clientAfterRender:function(){var e={app:this.app,active:this.getActiveFoldersIds(),selected:this.getSelectedFolder(),ownFolders:this.ownFolders,sharedFolders:this.sharedFolders,excludeActive:this.excludeActive,selectableGroup:this.selectableGroup,onSelect:this.onSelectedChange.bind(this),isGranted:this.isGranted.bind(this),onGroupClickCallback:this.onGroupClickCallback.bind(this)},i=t.FoldersList;this.containersOnly&&(i.templatePosition="bl",i.templateOffset={top:0,left:-15}),this.setView("FoldersSelectOptionsToolTip",new a({name:"FoldersSelectOptionsToolTip",params:i,classes:{"tooltip_extra-shadow":!0},content:new c(e)})),this.showLoading()},fetchFolders:function(e){var t=this;void 0===e&&(e=!1),Promise.all([this.ownFolders.fetch({reset:!0}),this.sharedFolders.fetch({reset:!0})]).then((function(){return t.render()})).catch((function(){d.warn("Can not get folders for select."),e&&t.fetchFolders()}))},handleFoldersSync:function(e){var t=this.getFoldersByModel(e).get(e.get("id"));t&&t.set(e.serialize()),this.render()},handleFoldersRemove:function(e){var t=this.getFoldersByModel(e);t.totalItems-=1,t.remove(e),this.render()},handleFoldersAdd:function(e,t,i){i.created&&(this.ownFolders.totalItems+=1,this.ownFolders.add(e,{at:0}))},handleRemoteFolderChanged:function(e){var t=e.id,i=this.getFolder(t);i&&i.fetch()},getFoldersByModel:function(e){return this[e.get("userId")===this.app.user.get("id")?"ownFolders":"sharedFolders"]},showLoading:function(){var e=this.ownFolders.pending&&this.sharedFolders.pending;this.spinner||(this.spinner=new r(s)),this.$el.toggleClass("is-fetching",e),this.spinner[e?"spin":"stop"](this.$el.get(0))},getFolder:function(e){return this.ownFolders.get(e)||this.sharedFolders.get(e)},getFolderColor:function(){var e=this;return l((function(){return e.getSelectedFolder().get("preferences").get("folderViewColor").get("value")}),"")||"696969"},getSelectedFolder:function(){var e=this,t=this.selected?this.getFolder(this.selected.id):null;if(t)return t;var i=this.getActiveFoldersIds(),s=parseInt(this.app.user.get("id"),10),n=function(t){var n=!i.includes(t.get("id")),r=t.get("userId")===s||"edit"===t.get("permission");return e.excludeActive&&n&&e.onlyEditable&&r};return this.ownFolders.find(n)||this.sharedFolders.find(n)},onClick:function(e){(this.ownFolders.length||this.sharedFolders.length)&&this.getView("FoldersSelectOptionsToolTip").toggle(e)},getActiveFoldersIds:function(){var e=this.getActiveFolder();return e?e instanceof Array?e.map((function(e){return e.get("id")})):[e.get("id")]:[]},onSelectedChange:function(e){if(this.getView("FoldersSelectOptionsToolTip").hide(),this.isGranted("auth")){var t=parseInt(e,10);this.selected=this.getFolder(t),this.onFoldersChange(this.selected),this.render()}},onGroupClickCallback:function(e){this.isGranted("auth")?this.selectableGroup?this.state.set({folderID:e}):this.getView("FoldersSelectOptionsToolTip").onTargetPosition():this.getView("FoldersSelectOptionsToolTip").hide()},serializeForm:function(){return{folder:this.getSelectedFolder().get("id")}},getActiveFolder:function(){},onFoldersChange:function(){}})}))}).call(this,i(9)(e))},2127:function(e,t,i){(function(e){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";var t=i(27),s=(0,i(12).getLogger)(e),n=i(1762),r={EmptySelectionFolders:i(2741),CreateFolder:i(2354),EditFolder:i(2743),DeleteFolder:i(2744),ShareFolder:i(1827),MoveFiles:i(2355),DeleteFiles:i(2356),CopyFiles:i(2302)},o=function(e){return e instanceof t.Model?[e.get("id")]:e instanceof Array?e.map((function(e){return e.get("id")})):[]},a=function(e,t){return new r[e](Object.assign({destroyOnHide:!0},t))};e.exports={createFolder:function(e,t){return new Promise((function(i){a("CreateFolder",{app:e,model:new n({},{app:e}),onCancelCallback:i,onSubmitCallback:function(n){t.createFolder(n).then((function(t){e.observer.broadcast(t.get("isPublic")?"Track:UE:Folders:CreatePublicPopup":"Track:UE:Folders:CreatePopup")})).catch((function(e){return s.error("Can't create folder. Error: "+e)})).finally(i)}}).show()}))},editFolder:function(e,t){return new Promise((function(i){a("EditFolder",{app:e,model:t,onCancelCallback:i,onSubmitCallback:function(n){t.promiseSave(n,{wait:!0,observable:!0}).then((function(){e.observer.fire("Notification",{type:"success"}),e.observer.broadcast(t.get("isPublic")?"Track:UE:Folders:EditPublicPopup":"Track:UE:Folders:EditPopup")})).catch((function(e){return s.error("Can't edit folder. Error: "+e)})).finally(i)}}).show()}))},moveFolders:function(e){var t=this;void 0===e&&(e={});var i=e,n=i.app,r=i.folders,l=i.foldersToMove,c=i.isGranted,u=void 0===c?function(){}:c,d=o(l);return new Promise((function(e){a("MoveFiles",{app:n,folders:r,getActiveFolder:function(){return l},isGranted:u,onCancelCallback:e,onSubmitCallback:function(i){t.moveFoldersWithoutModal(n,r,d,i.folder).catch((function(e){return s.error("Can't move folders. Error: "+e)})).finally(e)}}).show()}))},moveFoldersWithoutModal:function(e,t,i,s){return t.moveFolders({source:i,target:s}).then((function(){t.fetch({reset:!0}),e.observer.fire("Notification",{type:"success"}),e.observer.broadcast("Track:UE:Folders:Move")}))},copyFolders:function(e){var t=e.app,i=e.folders,n=e.foldersToCopy,r=e.isGranted,o=void 0===r?function(){}:r,l=n instanceof Array?n:[n];return new Promise((function(e){a("CopyFiles",{app:t,getActiveFolder:function(){return n},isGranted:o,onCancelCallback:e,onSubmitCallback:function(n){i.copyFolders({source:l.map((function(e){return e.get("id")})),target:n.folder}).then((function(e){i.fetch({reset:!0}),t.observer.fire("Favorites:RemoteFolderChanged",{id:e.target}),t.observer.fire("Notification",{type:"success"})})).catch((function(e){s.error("Can't copy files. Error: "+e),t.observer.fire("Notification",{type:"error"})})).finally(e)}}).show()}))},addToCart:function(e,t,i){var s=o(i);t.addToCart(s).then((function(){e.observer.fire("Notification",{type:"success"}),e.store.get("CartIndicator").fetch()}))},shareFolders:function(e,t,i,s){var n=this,r=t instanceof Array&&1===t.length?t[0]:t;s||r instanceof Array?this.callShareFolderModal(e,r,i,s):r.fetch({getQueryParams:{thumbsSize:"thumb",thumbsLimit:6}}).then((function(){n.callShareFolderModal(e,r,i,r.get("thumbs"))}))},callShareFolderModal:function(e,t,i,s){a("ShareFolder",{app:e,model:t,permissions:i,collection:s,asyncPermissionsLoad:!i}).show(),e.observer.broadcast("Track:UE:Folders:SharePopup")},removeFolders:function(e,t){var i=t instanceof Array?t:[t];return new Promise((function(t){a("DeleteFolder",{app:e,onCancelCallback:t,onSubmitCallback:function(){var n=i.map((function(e){return e.destroy()}));Promise.all(n).then((function(){e.observer.fire("Notification",{type:"success"})})).catch((function(t){e.observer.fire("Notification",{type:"error"}),s.error("Can't remove folder. Error: "+t)})).finally(t),e.observer.broadcast("Track:UE:Folders:DeletePopup")}}).show({model:1===i.length?i[0]:i})}))},callModal:function(){return a.apply(void 0,arguments)}}}))}).call(this,i(9)(e))},2288:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(0),s=i(161),n=function(){function e(e,i){var n=this;this.field=s(e),this.holder=null,this.options=t.extend({mode:"count",holder:"parent",min:0,max:0,prefix:"",format:"%count%"},i),this.createIndicator(),this.options.max>0&&this.field.attr("maxlength",this.options.max),this.field.on("input",(function(){return n.count()})),this.count()}var i=e.prototype;return i.createIndicator=function(){"object"==typeof this.options.holder?this.holder=this.options.holder:"parent"===this.options.holder?this.holder=this.field.parent():this.holder=s(this.options.holder),this.indicator=s("<i />",{class:"field-counter"}),this.holder.append(this.indicator)},i.count=function(){var e=this.field.val().length;"countdown"===this.options.mode&&(e=this.options.max-e);var t=this.options.format.replace("%count%",e).replace("%max%",this.options.max).replace("%prefix%",this.options.prefix);this.indicator.text(t),e>this.options.max||e<this.options.min||"countdown"===this.options.mode&&e<0?(this.field.trigger("incorrect"),this.indicator.addClass("red")):(this.field.trigger("reset"),this.indicator.removeClass("red"))},e}();e.exports=function(e,t){e.each((function(e,i){new n(i,t)}))}},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2300:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(1422),s=i(2353);e.exports=t.extend({url:"Folders",model:s,experimentalTrueParse:function(e,t){var i=e.lightboxes,n=void 0===i?[]:i,r=e.count;return e.stats,void 0===t&&(t={}),this.totalItems=parseInt(r,10),t.parse=!1,t.trueparse=!0,n.map((function(e){return s.prototype.parse(e,t)}))},parse:function(e,t){return this.experimentalTrueParse(e,t)},createFolder:function(e){var t=this;void 0===e&&(e={});var i=new s(e,{app:this.app});return i.promiseSave({},{wait:!0}).then((function(){return t.add(i,{at:0,created:!0})}))},updateFolder:function(e,t,i){return this.get(e).save(t,Object.assign({wait:!0,observable:!0},i))},deleteFolder:function(e){return this.get(e).destroy()},deleteFolders:function(e){var t=this;return e.forEach((function(e){return t.deleteFolder(e)}))},addToCart:function(e){var t=this;return this.promiseSync("update",this,{url:"CartFolderFiles",getQueryParams:{folderId:e}}).then((function(){return t.trigger("sync",t)}))},moveFolders:function(e){var t=this;return this.promiseSync("update",this,{url:"MoveFolderFiles",getQueryParams:e}).then((function(){return t.trigger("sync",t)}))},copyFolders:function(e){var t=this;return this.promiseSync("update",this,{url:"CopyFolderFiles",getQueryParams:e}).then((function(){return t.trigger("sync",t),e}))},isPageSetAndCorrect:function(){return this.app.queryParams.page&&!this.pager.hasNextPage(+this.app.queryParams.page)?(this.pager.set("totalItems",this.totalItems),this.pager.getUrl({page:this.pager.get("totalPages")})):null},onPagerChange:function(){this.fetch()}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2301:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(0),s=i(2742),n=i(599),r=i(2288);e.exports=n.extend({name:"EditFolderForm",template:s,clientAfterRender:function(){r(this.$("._counter"),{mode:"countdown",max:50})},serializeForm:function(){return{title:t.escape(this.$el.find("[name=title]").val().trim())}},serialize:function(){return this.model.serialize()}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2302:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(93),s=i(529),n=i(537),r=i(2126);e.exports=n.extend({name:"CopyFiles",initialize:function(){var e=this;this.title=t.CopyFilesTitle,this.body=function(){return new s({className:"fav-modal",views:{"":[new s({tagName:"p",className:"modal__text modal__text_indent",template:function(){return e.tr(t.CopyFilesMessage)+":"}}),new r({app:e.app,className:"fav-modal__select fav-modal__select_rounded fav-modal__select_large",getActiveFolder:e.getActiveFolder,excludeActive:!0,onlyEditable:!0,isGranted:e.isGranted.bind(e)})]}})},this.footer=[{label:t.CancelBtn,hide:!0,callback:this.onCancelCallback.bind(this)},{label:t.CopyFilesBtn,hide:!0,color:"blue",defaultAction:!0,callback:this.onSubmit.bind(this)}]},onSubmit:function(){var e=this.findView("FoldersSelect").serializeForm();this.onSubmitCallback(e)}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2353:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";var t=i(1762);e.exports=t.extend({getQueryParams:function(){return Object.assign({},this.attributes,{thumbsSize:"thumb",thumbsLimit:4})}})})?s.apply(t,n):s)||(e.exports=r)},2354:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(93),s=i(537),n=i(2301);e.exports=s.extend({name:"CreateFolder",initialize:function(){var e=this;this.title=t.CreateFolderTitle,this.body=function(){return new n({model:e.model,submit:e.onSubmit.bind(e)})},this.footer=[{label:t.CancelBtn,hide:!0,callback:this.onCancelCallback.bind(this)},{label:t.CreateFolderBtn,color:"blue",defaultAction:!0,callback:this.onSubmit.bind(this)}]},onSubmit:function(){var e=this.getBodyView().serializeForm();this.onSubmitCallback(e),this.hide()}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2355:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(93),s=i(529),n=i(537),r=i(2126);e.exports=n.extend({name:"MoveFiles",initialize:function(){var e=this;this.title=this.tr("Move Selected Files"),this.body=function(){return new s({className:"fav-modal",views:{"":[new s({tagName:"p",className:"modal__text modal__text_indent",template:function(){return e.tr("Select a folder to move the selected files to")+":"}}),new r({app:e.app,className:"fav-modal__select fav-modal__select_rounded fav-modal__select_large",getActiveFolder:e.getActiveFolder,collection:e.folders,excludeActive:!0,onlyEditable:!0,isGranted:e.isGranted.bind(e)})]}})},this.footer=[{label:t.CancelBtn,hide:!0,callback:this.onCancelCallback.bind(this)},{label:this.tr("Move Files"),hide:!0,color:"blue",defaultAction:!0,callback:this.onSubmit.bind(this)}]},onSubmit:function(){var e=this.findView("FoldersSelect").serializeForm();this.onSubmitCallback(e)}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2356:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(93),s=i(537);e.exports=s.extend({initialize:function(){for(var e=this,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];s.prototype.initialize.apply(this,n),this.title=t.DeleteFilesTitle,this.message=this.tr(t.DeleteFilesMessage),this.footer=[{label:t.CancelBtn,hide:!0,callback:function(){return e.onCancelCallback()}},{label:t.DeleteFilesBtn,color:"blue",hide:!0,defaultAction:!0,callback:function(){return e.onSubmitCallback()}}]}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2734:function(e,t,i){},2735:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<div class="'+t(e.className)+'"><span class="folders-select__selected-folder">';return e.folder?(i+='<i class="folders-select__selected-folder-icon">',e.folder.isOwn?i+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 16"><path fill="#'+(e.folder.color||696969)+'" fill-rule="evenodd" d="M18 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2zm-4-8l-1-4-2 4H7l3 2-1 4 3-2 4 2-1-4 3-2z"/></svg>':i+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 16"><path fill="#'+(e.folder.color||696969)+'" fill-rule="evenodd" d="M18 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2zm-3-5a1 1 0 0 1-1 0v-1a3 3 0 0 0 0-1 2 2 0 0 0 1-1V7a7 7 0 0 0 0-1 2 2 0 0 0-1-1 2 2 0 0 0 0-1 1 1 0 0 0-1 0 6 6 0 0 0-1 0 2 2 0 0 0-2 2 5 5 0 0 0 0 1v1a1 1 0 0 0 1 1 3 3 0 0 0 0 1v1a1 1 0 0 1-1 0l-2 2v1h9v-1l-2-2z" /></svg>',i+='</i><span class="fav-panel__selected-folder-title">'+t(e.folder.title)+"</span>",e.containersOnly||(i+='<span class="fav-panel__selected-folder-counter">'+t(e.folder.count)+"</span>")):(i+='<i class="folders-select__selected-folder-icon icon-my-folders"></i><span class="fav-panel__selected-folder-title ',e.emptyFolder.isShownCounter||(i+="fav-panel__selected-folder-title_without-counter"),i+='">'+t(e.emptyFolder.title)+"</span>",e.emptyFolder.isShownCounter&&(i+='<span class="fav-panel__selected-folder-counter">0</span>')),i+='</span><div class="folders-select__arrows-container"><i class="folders-select__arrows arrow arrow-black arrow-vertical"></i></div></div>'}})?s.apply(t,n):s)||(e.exports=r)},2736:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}i(2737);var s=i(864),n=i(2738),r=i(1445).default,o=i(2739),a=i(529);e.exports=a.extend({name:"FoldersSelectOptions",el:!1,template:n,active:null,selected:null,folders:null,selectableGroup:!1,events:{click:"onClick"},prepareRender:function(){var e={app:this.app,name:"owner",active:this.active,selected:this.selected,folders:this.ownFolders,excludeActive:this.excludeActive,selectableGroup:this.selectableGroup,onSelect:this.onSelect.bind(this),isGranted:this.isGranted.bind(this),onGroupClickCallback:this.onGroupClickCallback.bind(this)};this.setViews({"._owner-group":new o(e),"._shared-group":new o(t({},e,{name:"shared",folders:this.sharedFolders}))})},clientAfterRender:function(){var e=this;setTimeout((function(){return e.initPerfectScrollbar()}),0)},initPerfectScrollbar:function(){var e=this.$("._list").get(0);s.initialize(e,r)},onClick:function(e){e.stopPropagation()},onSelect:function(){},onGroupClickCallback:function(){}})}))},2737:function(e,t,i){},2738:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";e.exports=function(e){return'<div class="select-folder"><div class="select-folder__list _list"><div class="_owner-group"></div><div class="_shared-group"></div></div></div>'}})?s.apply(t,n):s)||(e.exports=r)},2739:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(2740),s=i(529);e.exports=s.extend({name:"FoldersSelectOptionsGroup",el:!1,template:t,active:null,selected:null,folders:null,selectableGroup:!1,events:{"click ._group":"onGroupClick","change ._folder-selection":"onFolderSelectionChange","click ._load":"handleLoadAllClick"},initialize:function(){this.listenTo(this.folders,"update",this.render)},serialize:function(){return{selected:this.selected?this.selected.get("id"):null,group:this.getGroupData()}},getGroupData:function(){var e=this,t={name:this.name,list:this.getFoldersWithColors(this.folders.serialize()),count:this.folders.getPager("totalItems"),hasNextPage:this.folders.pager.hasNextPage()};return this.excludeActive&&(t.list=t.list.filter((function(t){return!e.active.includes(t.id)}))),t},onFolderSelectionChange:function(e){this.onSelect(e.currentTarget.value)},getFoldersWithColors:function(e){return e.map((function(e){var t=e.preferences.find((function(e){return"folderViewColor"===e.name}));return t&&(e.viewColor=t.value),e}))},onGroupClick:function(e){this.selectableGroup||this.$(e.currentTarget).toggleClass("select-folder__part_closed"),this.onGroupClickCallback(e.currentTarget.dataset.group)},handleLoadAllClick:function(e){this.folders.setPager({limit:this.folders.totalItems}),this.$el.find("._load").addClass("loading")},onSelect:function(){},onGroupClickCallback:function(){}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2740:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i="<div>";e.group.list.length&&(i+='<div class="select-folder__part _group" data-group="'+t(e.group.name)+'">',"shared"===e.group.name?i+='<i class="select-folder__part-icon icon icon-shared-folders"></i>'+this.tr("Shared With Me"):i+='<i class="select-folder__part-icon icon icon-my-folders"></i>'+this.tr("My Folders"),i+='<span class="select-folder__part-size">'+t(e.group.count)+"</span></div>"),i+='<div class="select-folder__sub-list">';var s=e.group.list;if(s)for(var n,r=-1,o=s.length-1;r<o;)(n=s[r+=1])&&(i+='<label class="select-folder__item"><input class="select-folder__radio _folder-selection" type="radio" name="folder" value="'+t(n.id)+'"',e.selected===n.id&&(i+=' checked="checked"'),i+=" />",e.selected===n.id?(i+='<i class="select-folder__icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 16"><path fill="',n.viewColor?i+="#"+t(n.viewColor):i+="#969696",i+='" fill-rule="evenodd" d="M17 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2zM14 5l-6 6-2-2-1 1 3 3 7-7z"/></svg></i>'):(i+='<i class="select-folder__icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 16"><path fill="',n.viewColor?i+="#"+t(n.viewColor):i+="#d2d2d2",i+='" fill-rule="evenodd" d="M17 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2z"/></svg></i>'),i+='<span class="select-folder__text"><span class="select-folder__title">'+t(n.title)+'</span><span class="select-folder__counter">'+n.count+"</span></span>","shared"===e.group.name?("view"===n.permission&&(i+='<i class="select-folder__badge icon icon-folder-action-view"></i>'),"edit"===n.permission&&(i+='<i class="select-folder__badge icon icon-folder-action-edit"></i>')):n.isShared&&(i+='<i class="select-folder__badge icon icon-folder-action-share"></i>'),i+="</label>");return e.group.hasNextPage&&(i+='<div class="select-folder__load-more _load"><i class="icon icon-load-more"></i><span>'+this.tr("Load all")+"</span></div>"),i+="</div></div>"}},void 0===(r="function"==typeof s?s.apply(t,n):s)||(e.exports=r)},2741:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(93),s=i(537);e.exports=s.extend({name:"emptySelectionModal",title:t.ServiceModalTitle,message:function(){return this.tr(t.SelectFolders)}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2742:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<form class="modal__form"><label class="modal__form-field field-box field-box_light field-box_rounded field-box_large"><input class="input input-l _counter _field ';return e.title||(i+="empty"),i+='" type="text"name="title" maxlength="50" value="'+t(e.title)+'"/><span class="field-box__title">'+this.tr("Folder name")+"</span></label></form>"}})?s.apply(t,n):s)||(e.exports=r)},2743:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(93),s=i(537),n=i(2301);e.exports=s.extend({name:"EditFolder",initialize:function(){var e=this;this.title=t.EditFolderTitle,this.body=function(){return new n({model:e.model,submit:e.onSubmit.bind(e)})},this.footer=[{label:t.CancelBtn,hide:!0,callback:this.onCancelCallback.bind(this)},{label:t.SaveChangesBtn,hide:!0,color:"blue",defaultAction:!0,callback:this.onSubmit.bind(this)}]},onSubmit:function(){var e=this.getBodyView().serializeForm();this.onSubmitCallback(e),this.hide()}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2744:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(93),s=i(537);e.exports=s.extend({name:"DeleteFolder",initialize:function(){for(var e=this,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];s.prototype.initialize.apply(this,n),this.title=t.DeleteFolder,this.message=function(){if(e.model instanceof Array)return e.tr("Do you really want to delete %s folders?",e.model.length);var t=e.model.serialize().title;return e.tr("Do you really want to delete this folder")+' "'+t+'"?'},this.footer=[{label:t.CancelBtn,hide:!0,callback:this.onCancelCallback.bind(this)},{label:t.DeleteFolder,hide:!0,color:"blue",defaultAction:!0,callback:this.onSubmitCallback.bind(this)}]}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2745:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(1239),s=i(2127);e.exports={isGranted:function(e,t){var i=this;if(void 0===t&&(t=!0),!["string","object"].includes(typeof e))return!1;var s="string"==typeof e?e.split(" "):e,n={auth:{rule:function(){return i.app.user.isLoggedIn()},handler:function(){return i.authHandler()}},selection:{rule:function(){return i.isAnySelected()},handler:function(){return i.selectionHandler()}},edit:{rule:function(){return i.canEditFolderOrFolders()},handler:function(){return i.callModal("NeedPermission",{app:i.app}).show()}},remove:{rule:function(){return i.hasPermissionsTo("delete")},handler:function(){return i.callModal("NeedPermission",{app:i.app}).show()}},changeFiles:{rule:function(){return i.hasPermissionsTo("changeFiles")},handler:function(){return i.callModal("NeedPermission").show()}}};return s.every((function(e){var i=n[e]&&n[e].rule();return!i&&t&&n[e].handler(),i}))},isAnySelected:function(){return this.state.isFilesMode()?this.getSelectedFiles().length>0:this.getSelectedFolders().length>0},selectionHandler:function(){return this.state.isFilesMode()?this.callModal("EmptySelectionFiles").show():s.callModal("EmptySelectionFolders",{app:this.app}).show()},authHandler:function(e){var i=this;void 0===e&&(e="Click");var s=this.app.store.get("FileForFavorite"),n=null;s&&(n=new t({id:s.get("id"),imageUrl:s.makeThumb("wide"),width:s.get("width"),height:s.get("height"),type:s.get("type"),alt:s.get("title")},{app:this.app})),this.app.store.get("ModalsManager").show("SignupModal",{app:this.app,title:this.tr("Add to Favorites?"),previewFile:n}).then((function(){i.app.observer.broadcast("Track:UE:SignUp:ModalShow",{label:i.name+"/"+e}),i.app.store.unlink("FileForFavorite")})).catch((function(){}))},canEditFolderOrFolders:function(){if(this.state.isFilesMode()){var e=this.getActiveFolder();return e&&"edit"===e.get("permission")}var t=this.getSelectedFolders();return t.length&&t.every((function(e){return"edit"===e.get("permission")}))},hasPermissionsTo:function(e){if(this.state.isFilesMode()){var t=this.getActiveFolder();return t&&t.hasAction(e)}var i=this.getSelectedFolders();return i.length&&i.every((function(t){return t.hasAction(e)}))}}},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2751:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(93).ServiceModalTitle,s=i(537);e.exports=s.extend({name:"needPermissionModal",title:t,message:function(){return this.activeFolder?this.tr('"%s" folder is available to you in a "Read-only" format. Please contact the owner of the folder for permission to edit.',this.activeFolder.get("title")):this.tr("Sorry, you have no editing permissions.")}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2752:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(93),s=i(537);e.exports=s.extend({name:"emptySelectionModal",title:t.ServiceModalTitle,message:function(){return this.tr(t.EmptySelectionMessageFiles)}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},2753:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";var t=i(8);e.exports=t.extend({defaults:{userId:null,open:!1,editor:!1,folderID:null,thumbs:"normal",liftLevel:2},isFilesMode:function(){return!["owner","shared"].includes(this.get("folderID"))},isEmptyFoldersMode:function(){return!this.get("folderID")},wasFoldersMode:function(){return["owner","shared"].includes(this.previous("folderID"))},getFoldersGroupTitle:function(e){return void 0===e&&(e=this.get("folderID")),{owner:this.app.tr("My Folders"),shared:this.app.tr("Shared With Me")}[e]},getFoldersGroupPermissions:function(e){return void 0===e&&(e=this.get("folderID")),{owner:["owner"],shared:["edit","view"]}[e]}})})?s.apply(t,n):s)||(e.exports=r)},3905:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[i(154)],s=function(t){"use strict";function s(e,t,i,s,n,r,o){try{var a=e[r](o),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(s,n)}function n(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var o=e.apply(t,i);function a(e){s(o,n,r,a,l,"next",e)}function l(e){s(o,n,r,a,l,"throw",e)}a(void 0)}))}}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}t=function(e){return e&&e.__esModule?e:{default:e}}(t),i(3906),i(1502);var o=i(0),a=i(529),l=i(3907),c=i(2353),u=i(2300),d=i(3911),h=i(1677),f=i(3912),p=i(34),g=i(2753),v=i(2752),m=i(3914),b=i(2751),y=i(2354),_=i(2302),F=i(2355),w=i(2356),x=i(2127),k=i(2745),T=i(97),C="nonAuthFavFileAdding",S={page:1,limit:60},P={EmptySelectionFiles:v,CopyFiles:_,MoveFiles:F,DeleteFiles:w,SelectFolder:m,CreateFolder:y,NeedPermission:b};e.exports=a.extend(r({},k,{name:"FavoritesPanel",tagName:"div",className:"fav-panel-box",webSocketClient:null,initialStateOverrides:{},filesQueue:[],FavoritesPanelOpened:null,initialize:function(){var e=this;this.state=new g(this.getInitialState(),{app:this.app}),this.activeFolder=new c({},{app:this.app}),this.activeFolder.getQueryParams=function(){return r({},e.activeFolder.serialize(),{id:e.state.get("folderID")})},this.folders=new u([],{app:this.app,endless:!0,pager:S,filters:{permission:this.state.getFoldersGroupPermissions(),thumbsSize:"thumb",thumbsLimit:1}}),this.permissions=new h([],{app:this.app}),this.cache=new d([],{app:this.app}),this.collection=new f([],{app:this.app,pager:S,filters:{id:null},endless:!0}),this.selectedByContextMenu=new p([],{app:this.app}),this.app.store.link("FolderCache",this.cache),this.app.store.link("FolderState",this.state),this.listenTo(this.state,"change:folderID",this.onStateFolderIdChange),this.listenTo(this.collection,"update",this.actualizeCache),this.listenTo(this.cache,"reset update",this.folderCacheUpdateCallback),this.listenTo(this.folders,{update:this.handleFoldersUpdate}),this.listenTo(this.app.observer,{"Favorites:OpenPanel":this.handleDrag,"Favorites:ToggleFile":this.toggleFile,"Favorites:TogglePanel":this.togglePanel}),this.shouldFetchComponentsForOpenState()&&this.fetchComponentsForOpenState().then((function(){return e.render()})),this.isGranted("auth",!1)&&(this.state.get("folderID")||this.tryPlaceFirstFolderAsActive(),this.onStateFolderIdChange())},prepareRender:function(){var e=this;return!this.shouldFetchComponentsForOpenState()&&(this.setViews({"":this.state.get("open")?new this.FavoritesPanelOpened({app:this.app,state:this.state,cache:this.cache,collection:this.collection,folders:this.folders,permissions:this.permissions,activeFolder:this.activeFolder,selectedByContextMenu:this.selectedByContextMenu,isGranted:this.isGranted.bind(this),togglePanel:this.togglePanel.bind(this),callModal:this.callModal.bind(this),getActiveFolder:this.getActiveFolder.bind(this),isActiveFolderExist:this.isActiveFolderExist.bind(this),addFile:this.addFile.bind(this),deleteFile:this.deleteFile.bind(this),getSelectedFiles:this.getSelectedFiles.bind(this),getSelectedFolders:this.getSelectedFolders.bind(this),autoCreateFolder:this.autoCreateFolder.bind(this),updatePanelState:this.updatePanelState.bind(this),getWebSocketClient:function(){return e.webSocketClient},setWebSocketClient:function(t){e.webSocketClient=t},fetchFolders:this.fetchFolders.bind(this),fetchPermissions:this.fetchPermissions.bind(this),fetchCache:this.fetchCache.bind(this),fetchFolderDependencies:this.fetchFolderDependencies.bind(this)}):new l({app:this.app,state:this.state,collection:this.collection,shouldCallSignUpWhenOpen:this.shouldCallSignUpWhenOpen,openPanel:this.openPanel.bind(this),authHandler:this.authHandler.bind(this),getActiveFolder:this.getActiveFolder.bind(this)})}),!0)},getInitialState:function(){var e=this.app.userSettings.get("FavoritesPanel"),t=this.app.user.get("id");return e&&e.userId===t?r({},e,this.initialStateOverrides):r({userId:t},this.initialStateOverrides)},resetPanelToEmptyState:function(){this.updatePanelState({folderID:null}),this.collection.reset(),this.cache.reset(),this.checkFileToAddQueue()},handleFoldersUpdate:function(e,t){var i=t.created;t.reset,e.isEmpty()?this.resetPanelToEmptyState():i&&this.updatePanelState({folderID:e.first().get("id")})},actualizeCache:function(e,t){var i=t.changes,s=t.at;if(i){var n=i.added.map((function(e){return{id:e.get("id")}})),r=i.removed.map((function(e){return e.get("id")}));this.cache.add(n,{at:s,silent:!0}),this.cache.remove(r,{silent:!0}),this.cache.trigger("update",this.cache,{changes:i,at:s,refetch:!0})}},getSelectedFiles:function(){return this.cache.where({selected:!0})},getSelectedFolders:function(){return this.folders.where({selected:!0}).concat(this.selectedByContextMenu.models)},fetchFolders:function(e,t){var i=this.state.getFoldersGroupPermissions();if(!i){var s=this.getActiveFolder().get("userId")!==this.app.user.get("id")?"shared":"owner";i=this.state.getFoldersGroupPermissions(s)}this.folders.setFilters({permission:i}),this.folders.fetchPage(e,t)},innerAddFile:function(e,t){var i=this;void 0===t&&(t=0),this.isActiveFolderExist()?this.collection.addFile(e,this.getActiveFolder().get("id"),t):this.autoCreateFolder().then((function(){return i.collection.addFile(e,i.state.get("folderID"),t)}))},innerDeleteFile:function(e){var t=this,i=[e],s=this.cache.indexOf(this.cache.get(e));this.collection.delete({lightbox:this.state.get("folderID"),items:[e],positions:[s]}).then((function(){t.cache.remove(i)}))},toggleFile:o.throttle((function(e){if(!this.folders.length||this.state.isFilesMode())!this.isActiveFolderExist()||this.isGranted("changeFiles",!1)?this.toggleFileById(0|e.id):this.callModal("NeedPermission",{activeFolder:this.activeFolder}).show();else{var t=this.folders.last();t.hasAction("changeFiles")?(this.filesQueue.push(0|e.id),this.updatePanelState({folderID:t.get("id")})):this.callModal("SelectFolder",{onAfterHideCallback:function(){this.openPanel()}})}}),400),toggleFileById:function(e){this.cache.get(e)?this.deleteFile(e):this.addFile(e)},deleteFile:function(){this.isGranted("auth changeFiles")&&this.innerDeleteFile.apply(this,arguments)},addFile:function(e,t){e&&(this.isGranted("auth",!1)?(this.app.store.unlink("FileForFavorite"),this.innerAddFile(e,t)):(this.authHandler("addToFavorites"),this.updateCookieState({key:C,value:e})))},callModal:function(e,t){return this.insertView(e,new P[e](Object.assign({app:this.app,destroyOnHide:!0},t)))},updatePanelState:function(e){this.state.set(e),this.app.userSettings.set({FavoritesPanel:this.state.toJSON()}),this.updateCookieState()},updateCookieState:function(e){var t={expires:"1Y"};if(e)T.set(e.key,e.value,t);else{var i=o.omit(this.state.attributes,["open","folderID","liftLevel"]);i.visible=this.state.get("open"),i.lightbox=this.state.get("folderID"),i.thumbs="big"===i.thumbs?"medium":"small",T.set("10_lbpSettings",JSON.stringify(i),t),T.set("10_currentLevel",this.state.get("liftLevel"),t)}},getActiveFolder:function(){return this.activeFolder},isActiveFolderExist:function(){return this.activeFolder.get("id")},autoCreateFolder:function(){return x.createFolder(this.app,this.folders)},checkFileToAddQueue:function(){var e=T.get(C);e&&"null"!==e&&(this.updateCookieState({key:C,value:null}),this.openPanel(),this.innerAddFile(+e))},handleDrag:function(){this.state.get("open")||(this.togglePanel(),this.app.observer.broadcast("Track:UE:FavoritesPanel:Open",{action:"drag"}))},openPanel:function(){this.state.get("open")||this.togglePanel()},togglePanel:function(){var e=this;return n(t.default.mark((function i(){return t.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.updatePanelState({open:!e.state.get("open")}),!e.shouldFetchComponentsForOpenState()){t.next=4;break}return t.next=4,e.fetchComponentsForOpenState();case 4:e.render();case 5:case"end":return t.stop()}}),i)})))()},folderCacheUpdateCallback:function(e,t){this.isActiveFolderExist()&&(this.getActiveFolder().set({count:e.length},{observable:!0}),this.app.observer.fire("Favorites:PanelCacheUpdate",{folderId:this.state.get("folderID"),options:t}))},onStateFolderIdChange:function(){var e=this;this.state.isFilesMode()?(this.activeFolder.fetch().then((function(){e.updatePanelComponents(),e.fetchFolderDependencies(e.state.wasFoldersMode()),e.processFilesQueue()})).fail((function(){return e.resetPanelToEmptyState()})),this.folders.reset()):(this.activeFolder.set(this.activeFolder.defaults),this.cache.reset(),this.collection.reset(),this.fetchFolders(1,{reset:!0}),this.updatePanelComponents())},fetchFolderDependencies:function(e){if(this.isActiveFolderExist()){var t=this.state.get("folderID")!==this.collection.getFilters("id");(e||t)&&(this.fetchPermissions(),this.fetchCache(),this.fetchFiles())}},processFilesQueue:function(){var e=this;this.isActiveFolderExist()&&0!==this.filesQueue.length&&(this.filesQueue.forEach((function(t){e.toggleFileById(t)})),this.filesQueue=[])},fetchPermissions:function(){this.permissions.getQueryParams={folderId:this.state.get("folderID")},this.permissions.fetch({reset:!0})},fetchCache:function(){var e=this.getActiveFolder();this.cache.getQueryParams={id:e.get("id")},this.cache.fetch({reset:!0})},fetchFiles:function(){this.$("._scroll").scrollTop(0),this.collection.setFilters({id:this.state.get("folderID")}),this.collection.fetchPage(1,{reset:!0})},tryPlaceFirstFolderAsActive:function(){var e=this;this.folders.fetch().then((function(){var t=e.folders.first();e.updatePanelState({folderID:t?t.get("id"):null})})).fail((function(){return e.resetPanelToEmptyState()}))},shouldFetchComponentsForOpenState:function(){return this.state.get("open")&&null===this.FavoritesPanelOpened},fetchComponentsForOpenState:function(){var e=this;return n(t.default.mark((function s(){var n,r;return t.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([i.e(5),i.e(21),i.e(16)]).then(i.t.bind(null,4088,7));case 2:n=t.sent,r=n.default,e.FavoritesPanelOpened=r;case 5:case"end":return t.stop()}}),s)})))()},updatePanelComponents:function(){var e=this.findView("FavoritesPanelContent");e&&e.render()}}))},void 0===(r="function"==typeof s?s.apply(t,n):s)||(e.exports=r)},3906:function(e,t,i){},3907:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(3908),s=i(529),n=i(3909);e.exports=s.extend({name:"FavoritesPanelClosed",template:t,events:{"click ._pull":"handlePullerClick"},prepareRender:function(){this.setViews({"._msg-box":new n({app:this.app,state:this.state,collection:this.collection,openPanelCallback:this.openPanel.bind(this),getActiveFolder:this.getActiveFolder.bind(this)})})},handlePullerClick:function(e){this.shouldCallSignUpWhenOpen?this.authHandler():this.openPanel(),this.app.observer.broadcast("Track:UE:FavoritesPanel:Open",{action:"click"})},openPanel:function(){},authHandler:function(){},getActiveFolder:function(){}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},3908:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";e.exports=function(e){return'<div class="fav-panel-closed"> <div class="fav-panel-msg-box _msg-box"></div> <div class="fav-panel fav-panel_closed _pull"> <div class="fav-panel__row"> <div class="fav-panel__cell"> <div class="fav-panel__shadow"></div> </div> <div class="fav-panel__cell fav-panel__cell_middle"> <div class="fav-panel__tab-wrapper"> <div class="fav-panel__tab"> <span class="fav-panel__tab-title"> <i class="fav-panel__tab-icon icon icon-favorites"></i> '+this.tr("Favorites")+' </span> <div class="fav-panel__tab-shadow"></div> </div> </div> </div> <div class="fav-panel__cell"> <div class="fav-panel__shadow"></div> </div> </div> <div class="fav-panel__row"> <div class="fav-panel__cell"> <div class="fav-panel__bg"></div> </div> <div class="fav-panel__cell fav-panel__cell_middle"> <div class="fav-panel__bg"></div> </div> <div class="fav-panel__cell"> <div class="fav-panel__bg"></div> </div> </div> </div></div>'}})?s.apply(t,n):s)||(e.exports=r)},3909:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";var t=i(3910),s=i(529),n=i(8),r=i(859).getAudioCoverByGenre;e.exports=s.extend({name:"FavoritesMessage",el:!1,template:t,count:1,timer:null,events:{"click ._open":"onOpenClick","click ._close-msg":"onCloseMsgClick"},initialize:function(){this.messageModel=new n({showed:!1,thumb:null,count:1}),this.listenTo(this.app.observer,"Favorites:fileAdded",this.fileAdded),this.listenTo(this.messageModel,"change:thumb",this.render)},serialize:function(){return{showed:this.messageModel.get("showed"),count:Math.min(this.messageModel.get("count"),3),prevCount:Math.min(this.messageModel.get("count")-1,3),folderThumb:this.messageModel.get("thumb"),folderPreviousThumb:this.messageModel.previous("thumb"),folderName:this.getFolderName()}},clientAfterRender:function(){var e=this;this.messageModel.get("showed")&&setTimeout((function(){return e.show()}),100)},getFolderName:function(){var e=this.getActiveFolder();return e?e.get("title"):""},fileAdded:function(e){if(!this.state.get("open")&&this.collection.get(e.id)){var t=this.messageModel.get("count");this.messageModel.get("showed")?t+=1:t=1;var i=this.collection.get(e.id),s=i.isAudio()?r(i.get("genre"),96):i.makeThumb("normal");this.messageModel.set({showed:!0,thumb:s,count:t})}},show:function(){var e=this;clearTimeout(this.timer),this.$el.addClass("fav-msg_visible"),this.$("._img").removeClass("fav-msg__img_hidden"),setTimeout((function(){return e.$("._img-box").addClass("fav-msg__img-box_count"+e.messageModel.get("count"))}),200),this.timer=setTimeout((function(){return e.hide()}),3e3)},hide:function(){var e=this;this.$el.removeClass("fav-msg_visible"),setTimeout((function(){return e.messageModel.set({showed:!1,count:1,thumb:null})}),200)},onOpenClick:function(){this.openPanelCallback(),this.hide()},onCloseMsgClick:function(e){e.stopPropagation(),clearTimeout(this.timer),this.hide()},openPanelCallback:function(){}})}))},3910:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<div class="fav-msg';return e.showed&&e.count>1&&(i+=" fav-msg_visible"),i+='"><div class="fav-msg__wrap _open"><div class="fav-msg__img-box fav-msg__img-box_count'+e.prevCount+' _img-box"><div class="fav-msg__img',e.folderPreviousThumb&&(i+=" fav-msg__img_hidden"),i+=' _img"',e.folderThumb&&(i+=' style="background-image: url('+t(e.folderThumb)+');"'),i+="></div>",e.folderPreviousThumb&&(i+='<div class="fav-msg__img fav-msg__img_prev" style="background-image: url('+t(e.folderPreviousThumb)+');"></div><div class="fav-msg__img fav-msg__img_back"></div>'),i+='</div><span class="fav-msg__text">'+this.tr("Added to “<b>%s</b>”",e.folderName)+'</span><div class="fav-msg__close _close-msg"><i class="fav-msg__icon icon icon-close-small-white"></i></div><i class="fav-msg__pointer"></i></div></div>'}})?s.apply(t,n):s)||(e.exports=r)},3911:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(8),s=i(34);e.exports=s.extend({url:"FolderCache",model:t.extend({defaults:{id:null,selected:!1},parse:function(e){return{id:parseInt(e,10)}}}),reorder:function(e,t){var i=this;return this.sync("update",this,{getQueryParams:Object.assign({},this.getQueryParams,{fileId:e,index:t}),success:function(){return i.trigger("sync",i)}}).promise()},getSelected:function(){return this.where({selected:!0})},getSelectedIds:function(){return this.getSelected().map((function(e){return e.id}))}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},3912:function(e,t,i){(function(e){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";var t=i(0),s=i(1422),n=i(3913),r=(0,i(12).getLogger)(e);e.exports=s.extend({url:"FavoriteFiles",model:n,parse:function(e){if(e instanceof Array)return e;var t=e.count,i=e.items,s=void 0===i?[]:i;return this.totalItems=Math.max(parseInt(t,10),0),s},addFile:function(e,i,s){var o=this,a=new n({id:e},{app:this.app});return this.listenToOnce(a,"sync",(function(i,n){n.errors?r.error("FavoriteFiles: "+t.pluck(n.errors,"error_message").join(". ")):(o.add(i,{at:s}),o.app.observer.fire("Favorites:fileAdded",{id:e}))})),a.save({},{wait:!0,getQueryParams:{id:e,folder:i,at:s}}).promise()},copy:function(e){var t=this;return this.sync("update",this,{url:"FavoriteFilesCopy",getQueryParams:e,success:function(){return t.trigger("sync",t,{})}})},move:function(e){var t=this;return this.sync("update",this,{url:"FavoriteFilesMove",getQueryParams:e,success:function(){t.trigger("sync",t,{}),t.remove(e.items)}})},delete:function(e){var t=this;return this.sync("update",this,{url:"FavoriteFilesRemove",getQueryParams:e,success:function(){t.trigger("sync",t,{}),t.remove(e.items),t.app.observer.fire("Favorites:filesRemoved",{ids:e.items})}})},onPagerChange:function(){this.fetch()}})}))}).call(this,i(9)(e))},3913:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(0),s=i(833);e.exports=s.extend({url:"FavoriteFile",getQueryParams:t.noop,parse:function(e,i){if(e.errors)return this.trigger("invalid",this,e.errors),{};var n=e.items?t.first(e.items):e;return s.prototype.parse.call(this,n,i)}})},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},3914:function(e,t,i){var s,n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[],void 0===(r="function"==typeof(s=function(){"use strict";var t=i(537);e.exports=t.extend({name:"SelectFolderModal",initialize:function(){var e=this;t.prototype.initialize.apply(this),this.title=this.tr("Select a Folder"),this.message=function(){return e.tr("Please select a folder in your Favorites to add the selected file to.")},this.footer=[{label:this.tr("Ok"),color:"blue",hide:!0,defaultAction:!0}]}})})?s.apply(t,n):s)||(e.exports=r)},599:function(e,t,i){var s,n,r,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,o=function(){"use strict";var t=i(0),s=i(529),n=i(533),r=s.extend({name:"Form",el:!1,model:null,events:{submit:"onSubmit","input ._field":"onRegularFieldInput","focusin ._field":"onRegularFieldFocusIn","focusout ._field":"onRegularFieldFocusOut"},initialize:function(){if(!this.model)throw new Error(this.name+": form model is required!");this.model.enableViewValidation(this),this.setModelListeners()},setModelListeners:function(){this.listenTo(this.model,{invalid:this.handleModelInvalid,error:this.handleModelError,request:this.handleModelRequest,sync:this.handleModelResponse})},remove:function(){this.model.disableViewValidation(this);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];s.prototype.remove.apply(this,t)},onSubmit:function(e){e&&e.preventDefault(),this.prepareSubmit(),this.validate()?this.submit():this.onPreSubmitFail()},submit:function(){this.model.save()},validate:function(){return this.model.isValid(!0)},handleModelInvalid:function(e,i){var s=this;t.size(i)&&Object.entries(i).forEach((function(e){var t=e[0],i=e[1],n=Array.isArray(i)?i[0]:i;s.fieldIncorrect(s.$("[name="+t+"]").parent(),{errorMessage:"string"==typeof n?s.tr(n):n})}))},resetErrors:function(){var e=this;t.each(this.$(".field-box_incorrect input, .field-box_incorrect select"),(function(t){return e.fieldReset(e.$(t).parent())}))},onRegularFieldInput:function(e){this.handleUpdateField(e),this.model.set(e.currentTarget.name,e.currentTarget.value)},onRegularFieldFocusIn:function(e){this.fieldReset(this.$(e.currentTarget).parent())},serialize:function(){},prepareSubmit:function(){},onPreSubmitFail:function(){},handleModelRequest:function(){},handleModelResponse:function(){},handleModelError:function(){},onRegularFieldFocusOut:function(){}});Object.assign(r.prototype,n),e.exports=r},n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)},826:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";var t=i(0),s=i(529),n=i(34),r=i(20),o="none";e.exports=s.extend({name:"Tabs",el:!1,schema:[],subSchema:[],preventDefaultAction:!1,urlLessTabs:!1,menuUnderline:!1,classNames:"",active:"",subActive:"",serializeData:{},events:{"click ._tab":"onTabClick","mouseenter ._tab":"onTabMouseEnter","mouseleave ._tab":"onTabMouseLeave","touchend ._scroll":"onScrollTouchEnd","click ._nav-left":"onNavLeftClick","click ._nav-right":"onNavRightClick"},globals:{"resize window":"onWindowResize"},initialize:function(){this.schema=new n(t.result(this,"schema")),this.defineActiveTab(),this.subSchema=new n(t.result(this,"subSchema")),this.prepareSubTabs(),this.listenTo(this.schema,"change update",this.render)},serialize:function(){return Object.assign({},{classNames:this.classNames,urlLessTabs:this.urlLessTabs,scheme:this.getEnabled().map((function(e){return e.serialize()})),subScheme:this.subSchema.serialize(),isRendered:this.isRendered},this.serializeData)},clientAfterRender:function(){this.menuUnderline&&this.setDefaultMenuUnderline(),this.isScrollPositionSet&&(this.setScrollPosition(),this.$("._scroll").removeClass("invisible")),this.updateNavigation(),this.isRendered=!0},onWindowResize:t.throttle((function(){this.menuUnderline&&this.setDefaultMenuUnderline(),this.isScrollPositionSet&&this.setScrollPosition(),this.updateNavigation()}),10),onTabClick:function(e){var t,i=e.currentTarget.dataset.key,s=this.schema.findWhere({key:i});s&&s.get("onClick")?s.get("onClick").call(null,e):((this.preventDefaultAction||s&&s.get("toggler")||s&&s.get("active")||s&&!0===s.get("isDefault")&&this.schema.findWhere({toggler:!0,active:!0}))&&e.preventDefault(),s&&s.get("toggler")&&s.get("active")&&(i=this.schema.findWhere({isDefault:!0}).get("key"),t=s.get("key")),s&&"_blank"!==s.get("target")&&this.setActiveTab(i,t))},onTabMouseEnter:function(e){if(this.menuUnderline){var t=this.$(e.currentTarget),i=t.offset().left-this.$el.offset().left;this.menuUnderlinePosition(i,t.outerWidth())}},onTabMouseLeave:function(){if(this.schema.where({active:!0}).length>0){var e=this.schema.findWhere({pseudoActive:!0});e&&e.set({pseudoActive:!1})}this.menuUnderline&&this.setDefaultMenuUnderline()},onScrollTouchEnd:function(){this.updateNavigation()},onNavLeftClick:function(){var e=this,t=this.$("._scroll").scrollLeft();this.$("._scroll").animate({scrollLeft:Math.max(t-100,0)},300,(function(){return e.updateNavigation()}))},onNavRightClick:function(){var e=this,t=this.$("._scroll").scrollLeft();this.$("._scroll").animate({scrollLeft:t+100},300,(function(){return e.updateNavigation()}))},updateNavigation:function(){var e=this.$("._scroll");if(0!==e.length){var t=this.$("._tab:last"),i=t.offset().left+t.width()-16;this.$("._nav-left").toggleClass("active",e.scrollLeft()>16),this.$("._nav-right").toggleClass("active",i>e.width())}},setDefaultMenuUnderline:function(){var e=this.$("._tab-active"),t=e.offset().left-this.$el.offset().left;this.menuUnderlinePosition(t,e.outerWidth())},menuUnderlinePosition:function(e,t){this.$("._menu-underline").css({left:e,width:t}).removeClass("hidden")},setScrollPosition:function(){var e=this.$("._active");if(0!==e.length){var t=e.offset().left;t+e.outerWidth()>window.innerWidth&&this.$("._scroll").scrollLeft(t)}},defineActiveTab:function(){var e=this;if(this.schema.each((function(i){var s=null!=i.get("active")?i.get("active"):e.defineTabActivityByProperty(i);e.active===o&&(s=!1),i.set({url:e.app.makeUrl(i.get("urlKey")||i.get("key")||""),active:null!=s?s:e.defineTabByUrl(i),enabled:t.isUndefined(i.get("enabled"))||!0===i.get("enabled")||t.isFunction(i.get("enabled"))&&i.get("enabled")(e.app.user)})})),this.shouldForceSetActive()){var i=this.schema.findWhere({isDefault:!0})||this.schema.first();i&&this.setActiveTab(i.get("key"),void 0,{silent:!0})}},shouldForceSetActive:function(){return!(this.active===o||this.getActiveTab()&&this.getActiveTab().get("enabled"))},prepareSubTabs:function(){var e=this;this.subSchema.each((function(i){return i.set({url:e.app.makeUrl(i.get("urlKey")||i.get("key")||""),active:i.get("key")===e.subActive,enabled:t.isUndefined(i.get("enabled"))||!0===i.get("enabled")||t.isFunction(i.get("enabled"))&&i.get("enabled")(e.app.user)})}))},defineTabActivityByProperty:function(e){return this.active&&this.active.length?e.get("key")===this.active:null},defineTabByUrl:function(e){var t=this.app.makeUrl(e.get("key"));return!!t&&(this.app.parsedUrl.pathname===t||!e.get("isDefault")&&r.isBelongTo(t+"/",this.app.parsedUrl.pathname+"/"))},reset:function(e){this.setActiveTab(e||this.schema.first().get("key"))},setActiveTab:function(e,t,i){this.schema.findWhere({key:e}).get("active")||(this.getActiveTab()&&this.getActiveTab().set({active:!1}),this.schema.findWhere({key:e}).set({active:!0}),t&&this.schema.findWhere({key:t}).set({pseudoActive:!0}),i&&i.silent||this.changeTabCallback(this.getActiveTab()))},getActiveTab:function(){return this.schema.findWhere({active:!0})},getActiveTabIndex:function(){return this.schema.indexOf(this.getActiveTab())},getEnabled:function(){return this.schema.where({enabled:!0})},changeTabCallback:function(){}})}))},833:function(e,t,i){var s,n,r;!function(i,o){n=[],void 0===(r="function"==typeof(s=o)?s.apply(t,n):s)||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,(function(){"use strict";function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var s=i(0),n=i(51),r=i(1237),o=i(1234),a=i(1226),l=i(835),c=i(1235),u=i(1236),d=r.prototype,h=(d.constructor,function(e,t){if(null==e)return{};var i,s,n={},r=Object.keys(e);for(s=0;s<r.length;s++)i=r[s],t.indexOf(i)>=0||(n[i]=e[i]);return n}(d,["constructor"])),f=n.extend(h).extend(t({},l,{url:"File",defaults:t({},r.prototype.defaults,{blocked:!1,published:null,buffs:[],inCart:!1,inFavorites:!1,free:!1,discount:0,purchased:[],licensed:[],editorial:!1,nudity:null,mp:"",ar:"",fps:null,length:null,sellerName:"",avatar:null,level:null,views:null,url:null,title:"",localizedTitles:{},description:"",alt:"",categories:[],tags:[],shortTags:[],restrictions:{},reDownloadExpiration:{},lightfield:!1,hideActions:null,crelloTemplateThumb:""}),relations:{restrictions:o},parseFromFile:function(e){return e&&e.result&&e.result[0]?e.result[0]:{}},parseFromSearch:function(e){return e||{}},parseFromCollection:function(e){return e&&(e.url=this.makeFavoritesUrl(e),e.title=e.favoriteTitle,e.hideActions=!0),e||{}},parse:function(e,t){void 0===t&&(t={});var i=this[t.parser],n="function"==typeof i?i.call(this,e,t):e,r=this.getErrors(n,e);if(Object.keys(r).length)return this.validationError=r,this.trigger("invalid",this,r,{validationError:r}),{};var o=s.pick(n,Object.keys(this.defaults));return o.type=this.parseFileType(n.type),o.published=1e3*n.uploadTimestamp,o.title=n.title||n.description,o.alt=n.alt||o.title,o.reDownloadExpiration=n.purchase_info&&n.purchase_info.re_download_expiration||{},o.purchased=function(e){var t=e&&e.purchase_info?e.purchase_info.purchased:[];return Object.values(t).map((function(e){return{size:"object"==typeof e?e.size:e,data:"object"==typeof e?e.data:{}}}))}(n),o.discount=function(e){return e.discount?e.discount:e.purchase_info&&e.purchase_info.lightbox_discount?parseInt(e.purchase_info.lightbox_discount,10):0}(n),o.free=100===o.discount,o.licensed=n.licensed||[],o.crelloTemplateThumb=n.crello_template,o.width=this.parseSize(n.width,n.type),o.height=this.parseSize(n.height,n.type),o},getQueryParams:function(){return s.pick(this.attributes,Object.keys(this.defaults))},parseSize:function(e){return e},parseRelated:function(e,t){return this.parseFromFile(t)[{models:"same_model",similar:"similar",series:"series",portfolio:"portfolio"}[e]]||[]},getFreeInfo:function(){return this.get("free")||this.isFreeLicenseAvailable()?{freeLabel:"Free"}:{}},isFreeLicenseAvailable:function(){var e=this.app.licensor.getUserLicenses().find((function(e){return"attributed_free"===e.name}));return e&&e.bit&this.get("licenseMask")},isFreeCurated:function(){if(!this.get("buffs"))return!1;var e=this.get("buffs").find((function(e){return"curated"===e.name}));return e&&100===e.options.discount},getRestrictions:function(e){var t=this.get("restrictions");if(!t)return[];var i=t.get(e);return Array.isArray(i)?i:[]},makeFavoritesUrl:function(e){return this.app.makeUrl({route:"Folder",folderName:e.favoriteName,folderId:e.favoriteId},{absolute:!0})},makeRelatedUrl:function(e,t){var i=e.offset,s=e.sorting,n=e.relatedTo;switch(n){case"portfolio":return this.makePortfolioUrl({offset:i,sorting:s});case"series":n="serie";break;case"similar":n={image:"similar-images",vector:"similar-vectors",video:"similar-videos"}[this.get("type")]}return this.app.makeUrl({route:"Related",relatedItemId:this.get("id"),relatedTo:n,offset:i,sorting:s},{absolute:t})},makeSizeLabel:function(e){return a.makeSizeLabel(this.attributes,e,this.toJSON())},isValidForRedownload:function(e){var t=this.get("reDownloadExpiration")[e],i=this.isPurchased(e)||this.isLicensed(e);return t?Date.now()-1e3*t<0:i},getPurchase:function(e){return this.get("purchased").find((function(t){return t.size===e}))},setPurchase:function(e,t){var i=this.getPurchase(e);return i||(i={size:e,data:t||{}},this.set("purchased",[].concat(this.get("purchased"),[i]))),i},isBannedForCountry:function(){return this.getRestrictions("countries").includes(this.app.getCurrentCountryCode())},isPurchased:function(e){return!!this.getPurchase(e)},isLicensed:function(e){var t=this.app.licensor.getConfig().sizes;return this.get("licensed").some((function(i){return i.sizes&t[e]}))},isAvailableEnterpriseOnly:function(){return 2===this.get("permissionMask")},isFree:function(){return this.get("free")},isEditorial:function(){return this.get("editorial")},isFreeForSize:function(e){return this.isFree()&&"el0"!==e}})),p=c({getThumbSource:function(e){return e.get("thumbSource")},getSellerId:function(e){return e.get("sellerId")},getFilename:function(e){return e.get("filename")}}),g=u();e.exports=f.extend({defaults:t({},f.prototype.defaults,p.defaults),initialize:function(){f.prototype.initialize.call(this),g.initialize.call(this),p.initialize.call(this)},getVideoThumbs:function(e){if(this.isVideo())return g.getVideoThumbs.call(this,e);throw new Error("Method available only for video files")},parseSize:function(e,t){return this.isAudioRawType(t)?p.parseSize.call(this):f.prototype.parseSize.call(this,e)},makeUrl:function(e,t){return this.isAudio()?p.makeUrl.call(this,e,t):f.prototype.makeUrl.call(this,e,t)},makePreviewThumb:function(){if(this.isAudio())return p.makePreviewThumb.call(this);throw new Error("Method available only for audio files")},makeThumbDownloadUrl:function(){if(this.isAudio())return p.makeThumbDownloadUrl.call(this);throw new Error("Method available only for audio files")},makePortfolioUrl:function(e){var t=void 0===e?{}:e,i=t.offset,s=t.sorting;return this.isAudio()?p.makePortfolioUrl.call(this):this.app.makeUrl({route:"Search",seller:this.get("sellerId"),offset:i,sorting:s})},fetchPeaks:function(){if(this.isAudio())return p.fetchPeaks.call(this);throw new Error("Method available only for audio files")},isMusicAudioType:function(){if(this.isAudio())return p.isMusicAudioType.call(this);throw new Error("Method available only for audio files")}})}))}}]);